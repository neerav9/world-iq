<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>WORLD IQ ‚Äî Gamified Intelligence</title>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Nunito:wght@400;600;700;800;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<link rel="icon" href="data:,">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
:root{
  --bg:#07090f;--surface:#0c0f1a;--card:#111626;--card2:#161c2e;--border:rgba(255,255,255,0.07);
  --text:#eef0f8;--muted:#3d4a65;--dim:#1a2035;
  --xp:#7c3aed;--xp2:#a855f7;
  --gold:#f5c842;--gold2:#e8a020;--goldfaint:rgba(245,200,66,0.08);
  --silver:#c8d8ee;--silverfaint:rgba(200,216,238,0.07);
  --green:#00e676;--red:#ff4560;--blue:#00bfff;--orange:#ff8c42;
  --ff:'Nunito',sans-serif;--ffm:'JetBrains Mono',monospace;--ffh:'Rajdhani',sans-serif;
}
html,body{height:100%;background:var(--bg);color:var(--text);font-family:var(--ff);overflow-x:hidden;-webkit-font-smoothing:antialiased}
::-webkit-scrollbar{width:3px;height:3px}::-webkit-scrollbar-thumb{background:var(--dim);border-radius:2px}

/* ‚îÄ‚îÄ AMBIENT ‚îÄ‚îÄ */
.orb{position:fixed;border-radius:50%;filter:blur(100px);pointer-events:none;z-index:0}
.orb1{width:500px;height:500px;top:-150px;left:-150px;background:rgba(124,58,237,0.06)}
.orb2{width:400px;height:400px;bottom:-100px;right:-100px;background:rgba(245,200,66,0.04)}

/* ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ */
#topbar{
  position:sticky;top:0;z-index:200;
  background:rgba(7,9,15,0.94);backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
  padding:0 18px;height:56px;flex-shrink:0;
}
.tb-logo{font-family:var(--ffh);font-size:22px;font-weight:700;letter-spacing:0.06em;
  background:linear-gradient(135deg,#7c3aed,#a855f7,#00bfff);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent}
.tb-mid{display:flex;align-items:center;gap:10px}

/* XP BAR */
.xp-wrap{display:flex;align-items:center;gap:8px}
.xp-label{font-family:var(--ffm);font-size:10px;color:var(--muted);letter-spacing:0.1em}
.xp-bar{width:80px;height:6px;background:var(--dim);border-radius:3px;overflow:hidden}
.xp-fill{height:100%;background:linear-gradient(90deg,var(--xp),var(--xp2));border-radius:3px;transition:width 0.8s ease}
.xp-val{font-family:var(--ffm);font-size:11px;color:var(--xp2);font-weight:700}

.level-badge{
  display:flex;align-items:center;gap:6px;
  background:rgba(124,58,237,0.12);border:1px solid rgba(124,58,237,0.25);
  border-radius:20px;padding:4px 12px;cursor:pointer;transition:all 0.2s;
}
.level-badge:hover{background:rgba(124,58,237,0.2)}
.lv-icon{font-size:15px}
.lv-num{font-family:var(--ffm);font-size:12px;font-weight:700;color:var(--xp2)}
.lv-label{font-size:10px;color:var(--muted)}

.streak-badge{
  display:flex;align-items:center;gap:5px;
  background:rgba(245,200,66,0.08);border:1px solid rgba(245,200,66,0.2);
  border-radius:20px;padding:4px 10px;cursor:pointer;
}
.str-fire{font-size:14px}
.str-num{font-family:var(--ffm);font-size:12px;font-weight:700;color:var(--gold)}

#topbar-clock{font-family:var(--ffm);font-size:11px;color:var(--muted)}

/* ‚îÄ‚îÄ HOME SCREEN ‚îÄ‚îÄ */
#homescreen{position:relative;z-index:1;min-height:calc(100vh - 56px);padding:24px 18px 40px}

.home-hero{text-align:center;padding:32px 0 40px}
.home-greeting{font-size:14px;color:var(--muted);letter-spacing:0.1em;text-transform:uppercase;margin-bottom:8px;font-family:var(--ffm)}
.home-title{font-family:var(--ffh);font-size:clamp(32px,8vw,52px);font-weight:700;letter-spacing:0.04em;line-height:1.1;margin-bottom:10px}
.home-title span{background:linear-gradient(135deg,var(--gold),var(--xp2),var(--blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.home-sub{font-size:14px;color:var(--muted);max-width:400px;margin:0 auto}

/* DAILY QUEST BAR */
.quest-bar{
  background:var(--card);border:1px solid var(--border);
  border-radius:14px;padding:16px 18px;margin-bottom:28px;
  display:flex;align-items:center;gap:14px;
}
.quest-icon{font-size:26px;flex-shrink:0}
.quest-content{flex:1}
.quest-title{font-size:13px;font-weight:700;margin-bottom:4px}
.quest-sub{font-size:11px;color:var(--muted)}
.quest-progress-wrap{margin-top:8px;display:flex;align-items:center;gap:8px}
.quest-prog-bar{flex:1;height:4px;background:var(--dim);border-radius:2px;overflow:hidden}
.quest-prog-fill{height:100%;background:linear-gradient(90deg,var(--gold),var(--xp2));border-radius:2px;transition:width 0.8s ease}
.quest-pct{font-family:var(--ffm);font-size:10px;color:var(--gold)}
.quest-reward{font-family:var(--ffm);font-size:11px;color:var(--xp2);background:rgba(124,58,237,0.1);border:1px solid rgba(124,58,237,0.2);border-radius:8px;padding:4px 10px;flex-shrink:0}

/* ARENA GRID */
.arenas-label{font-family:var(--ffm);font-size:10px;letter-spacing:0.2em;text-transform:uppercase;color:var(--muted);margin-bottom:14px;display:flex;align-items:center;gap:10px}
.arenas-label::before{content:'';width:20px;height:1px;background:var(--xp2)}
.arenas-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:32px}
@media(min-width:600px){.arenas-grid{grid-template-columns:repeat(3,1fr)}}

.arena-card{
  background:var(--card);border:1px solid var(--border);
  border-radius:18px;padding:20px 16px;cursor:pointer;
  transition:all 0.3s;position:relative;overflow:hidden;
  display:flex;flex-direction:column;gap:8px;
  animation:cardIn 0.5s ease both;
}
.arena-card:nth-child(1){animation-delay:0.05s}
.arena-card:nth-child(2){animation-delay:0.1s}
.arena-card:nth-child(3){animation-delay:0.15s}
.arena-card:nth-child(4){animation-delay:0.2s}
.arena-card:nth-child(5){animation-delay:0.25s}
.arena-card:nth-child(6){animation-delay:0.3s}
@keyframes cardIn{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}

.arena-card::before{content:'';position:absolute;inset:0;opacity:0;transition:opacity 0.3s}
.arena-card:hover{transform:translateY(-3px);box-shadow:0 16px 40px rgba(0,0,0,0.4)}
.arena-card:hover::before{opacity:1}
.arena-card:active{transform:scale(0.97)}

.arena-emoji{font-size:32px;line-height:1;margin-bottom:2px}
.arena-name{font-family:var(--ffh);font-size:17px;font-weight:700;letter-spacing:0.04em}
.arena-sub{font-size:11px;color:var(--muted);line-height:1.4}

.arena-footer{display:flex;align-items:center;justify-content:space-between;margin-top:4px}
.arena-xp-badge{font-family:var(--ffm);font-size:9px;letter-spacing:0.1em;padding:2px 8px;border-radius:4px;border:1px solid}
.arena-streak{font-size:10px;color:var(--muted)}

/* arena colors */
.arena-gold{border-color:rgba(245,200,66,0.2)}
.arena-gold::before{background:radial-gradient(ellipse at 80% 20%,rgba(245,200,66,0.08),transparent 60%)}
.arena-gold .arena-xp-badge{color:var(--gold);border-color:rgba(245,200,66,0.3);background:rgba(245,200,66,0.05)}

.arena-india{border-color:rgba(255,140,66,0.2)}
.arena-india::before{background:radial-gradient(ellipse at 80% 20%,rgba(255,140,66,0.08),transparent 60%)}
.arena-india .arena-xp-badge{color:var(--orange);border-color:rgba(255,140,66,0.3);background:rgba(255,140,66,0.05)}

.arena-world{border-color:rgba(0,230,118,0.2)}
.arena-world::before{background:radial-gradient(ellipse at 80% 20%,rgba(0,230,118,0.07),transparent 60%)}
.arena-world .arena-xp-badge{color:var(--green);border-color:rgba(0,230,118,0.3);background:rgba(0,230,118,0.05)}

.arena-tech{border-color:rgba(168,85,247,0.2)}
.arena-tech::before{background:radial-gradient(ellipse at 80% 20%,rgba(168,85,247,0.08),transparent 60%)}
.arena-tech .arena-xp-badge{color:var(--xp2);border-color:rgba(168,85,247,0.3);background:rgba(168,85,247,0.05)}

.arena-markets{border-color:rgba(0,191,255,0.2)}
.arena-markets::before{background:radial-gradient(ellipse at 80% 20%,rgba(0,191,255,0.07),transparent 60%)}
.arena-markets .arena-xp-badge{color:var(--blue);border-color:rgba(0,191,255,0.3);background:rgba(0,191,255,0.05)}

.arena-science{border-color:rgba(255,69,96,0.2)}
.arena-science::before{background:radial-gradient(ellipse at 80% 20%,rgba(255,69,96,0.06),transparent 60%)}
.arena-science .arena-xp-badge{color:var(--red);border-color:rgba(255,69,96,0.3);background:rgba(255,69,96,0.05)}

/* ACHIEVEMENTS */
.achieve-row{display:flex;gap:10px;overflow-x:auto;padding-bottom:8px;scrollbar-width:none;margin-bottom:32px}
.achieve-row::-webkit-scrollbar{display:none}
.achieve{
  flex-shrink:0;width:72px;text-align:center;
  background:var(--card);border:1px solid var(--border);border-radius:14px;padding:10px 6px;
  transition:all 0.2s;cursor:pointer;
}
.achieve:hover{transform:scale(1.05)}
.achieve.locked{opacity:0.35;filter:grayscale(1)}
.achieve-icon{font-size:26px;margin-bottom:4px}
.achieve-name{font-size:9px;color:var(--muted);line-height:1.3}

/* ‚îÄ‚îÄ ARENA SCREEN ‚îÄ‚îÄ */
#arenascreen{position:relative;z-index:1;display:none;min-height:calc(100vh - 56px)}

.arena-topbar{
  display:flex;align-items:center;gap:12px;
  padding:14px 18px;border-bottom:1px solid var(--border);
  background:rgba(7,9,15,0.8);backdrop-filter:blur(12px);
  position:sticky;top:56px;z-index:100;
}
.back-btn{
  width:36px;height:36px;border-radius:10px;border:1px solid var(--border);
  background:none;color:var(--text);font-size:18px;cursor:pointer;
  display:flex;align-items:center;justify-content:center;flex-shrink:0;
  transition:all 0.2s;
}
.back-btn:hover{background:var(--dim);border-color:rgba(255,255,255,0.15)}
.arena-top-info{flex:1}
.arena-top-name{font-family:var(--ffh);font-size:20px;font-weight:700;letter-spacing:0.04em}
.arena-top-sub{font-size:11px;color:var(--muted)}
.arena-top-xp{font-family:var(--ffm);font-size:11px;color:var(--xp2)}

/* INNER TABS */
.inner-tabs{
  display:flex;background:var(--surface);
  border-bottom:1px solid var(--border);overflow-x:auto;scrollbar-width:none;
}
.inner-tabs::-webkit-scrollbar{display:none}
.itab{
  flex-shrink:0;padding:11px 18px;border:none;background:none;
  color:var(--muted);font-family:var(--ff);font-size:12px;font-weight:700;
  letter-spacing:0.06em;text-transform:uppercase;cursor:pointer;
  border-bottom:2px solid transparent;transition:all 0.25s;white-space:nowrap;
}
.itab:hover{color:var(--text)}
.itab.active{color:var(--text);border-bottom-color:var(--xp2)}

.arena-content{padding:20px 18px 60px;max-width:860px;margin:0 auto}

.ipanel{display:none;animation:fadeSlide 0.3s ease}
.ipanel.active{display:block}
@keyframes fadeSlide{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

/* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:18px;margin-bottom:16px;position:relative;overflow:hidden}
.card-accent{position:absolute;top:0;left:0;right:0;height:2px}
.card-label{font-family:var(--ffm);font-size:9px;letter-spacing:0.18em;text-transform:uppercase;color:var(--muted);margin-bottom:12px;display:flex;align-items:center;gap:8px}
.card-label::before{content:'';width:16px;height:1px;background:currentColor}

/* PRICE CARDS */
.price-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px}
.price-card{
  background:var(--card2);border:1px solid var(--border);
  border-radius:14px;padding:16px;position:relative;overflow:hidden;
  cursor:pointer;transition:all 0.25s;
}
.price-card:hover{transform:translateY(-2px);box-shadow:0 12px 32px rgba(0,0,0,0.3)}
.price-card.gold-c{border-color:rgba(245,200,66,0.2)}
.price-card.gold-c::before{content:'';position:absolute;top:-30px;right:-30px;width:100px;height:100px;background:radial-gradient(circle,rgba(245,200,66,0.15),transparent 70%);pointer-events:none}
.price-card.silver-c{border-color:rgba(200,216,238,0.2)}
.price-card.silver-c::before{content:'';position:absolute;top:-30px;right:-30px;width:100px;height:100px;background:radial-gradient(circle,rgba(200,216,238,0.1),transparent 70%);pointer-events:none}

.pc-tag{font-family:var(--ffm);font-size:9px;letter-spacing:0.15em;text-transform:uppercase;margin-bottom:8px;display:flex;align-items:center;gap:6px}
.pc-dot{width:7px;height:7px;border-radius:50%;display:inline-block}
.pc-price{font-family:var(--ffm);font-size:clamp(22px,5vw,32px);font-weight:700;color:var(--text);line-height:1;margin-bottom:4px}
.pc-sub{font-size:11px;color:var(--muted)}
.pc-change{font-family:var(--ffm);font-size:12px;margin-top:8px;display:flex;align-items:center;gap:5px}
.up{color:var(--green)}.dn{color:var(--red)}
.pc-intl{font-size:10px;color:var(--muted);margin-top:2px;font-family:var(--ffm)}

/* CHART */
.chart-wrap{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:18px;margin-bottom:16px}
.chart-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;flex-wrap:wrap;gap:8px}
.chart-title{font-family:var(--ffh);font-size:16px;font-weight:600;letter-spacing:0.06em}
.range-btns{display:flex;gap:4px}
.rb{font-family:var(--ffm);font-size:10px;letter-spacing:0.08em;padding:4px 10px;border-radius:6px;border:1px solid var(--border);background:none;color:var(--muted);cursor:pointer;transition:all 0.2s}
.rb:hover,.rb.act{background:rgba(124,58,237,0.12);border-color:var(--xp2);color:var(--xp2)}
#priceChart{width:100%;height:180px;display:block}
.chart-legend{display:flex;gap:16px;margin-top:10px;flex-wrap:wrap}
.cl-item{display:flex;align-items:center;gap:6px;font-size:11px;color:var(--muted)}
.cl-dot{width:8px;height:8px;border-radius:50%}

/* WHY CARDS */
.why-card{
  background:var(--card2);border:1px solid var(--border);
  border-radius:14px;overflow:hidden;margin-bottom:10px;cursor:pointer;
  transition:border-color 0.2s;
}
.why-card:hover{border-color:rgba(255,255,255,0.12)}
.why-front{padding:14px 16px;display:flex;align-items:center;gap:12px}
.why-icon{font-size:26px;width:40px;text-align:center;flex-shrink:0}
.why-mid{flex:1}
.why-title{font-size:13px;font-weight:700;margin-bottom:3px}
.why-sub{font-size:11px;color:var(--muted)}
.why-impact{font-family:var(--ffm);font-size:9px;letter-spacing:0.1em;padding:3px 9px;border-radius:10px;border:1px solid;flex-shrink:0}
.imp-bull{color:var(--green);border-color:rgba(0,230,118,0.3);background:rgba(0,230,118,0.05)}
.imp-bear{color:var(--red);border-color:rgba(255,69,96,0.3);background:rgba(255,69,96,0.05)}
.imp-neut{color:var(--muted);border-color:var(--border)}
.why-chevron{color:var(--muted);font-size:12px;margin-left:8px;transition:transform 0.3s;flex-shrink:0}
.why-card.open .why-chevron{transform:rotate(180deg)}
.why-body{
  max-height:0;overflow:hidden;transition:max-height 0.4s ease,padding 0.3s;
  font-size:13px;color:#6a7fa0;line-height:1.75;
  border-top:0 solid var(--border);padding:0 16px;
}
.why-card.open .why-body{max-height:400px;padding:14px 16px;border-top-width:1px}
.why-body strong{color:var(--text);font-weight:600}
.why-body .tag{display:inline-block;font-family:var(--ffm);font-size:9px;letter-spacing:0.1em;text-transform:uppercase;padding:1px 7px;border-radius:4px;margin-bottom:6px}

/* FORECAST TIMELINE */
.ft-wrap{position:relative;padding-left:28px}
.ft-line-vert{position:absolute;left:10px;top:6px;bottom:6px;width:2px;background:linear-gradient(to bottom,var(--xp2),rgba(124,58,237,0.1))}
.ft-item{position:relative;margin-bottom:22px}
.ft-item:last-child{margin-bottom:0}
.ft-dot{
  position:absolute;left:-23px;top:3px;
  width:14px;height:14px;border-radius:50%;
  background:var(--bg);border:2px solid var(--xp2);
}
.ft-dot.now{background:var(--xp2);box-shadow:0 0 10px rgba(168,85,247,0.6)}
.ft-period{font-family:var(--ffm);font-size:10px;letter-spacing:0.12em;text-transform:uppercase;color:var(--xp2);margin-bottom:4px}
.ft-price-row{display:flex;align-items:baseline;gap:8px;margin-bottom:4px}
.ft-price{font-family:var(--ffm);font-size:20px;font-weight:700;color:var(--text)}
.ft-chg{font-family:var(--ffm);font-size:12px}
.ft-reason{font-size:12px;color:var(--muted);line-height:1.6}
.ft-conf-row{display:flex;align-items:center;gap:8px;margin-top:8px}
.ft-cbar{flex:1;height:3px;background:var(--dim);border-radius:2px;overflow:hidden}
.ft-cfill{height:100%;background:linear-gradient(90deg,var(--xp),var(--xp2));transition:width 1.2s ease 0.5s;border-radius:2px}
.ft-clabel{font-family:var(--ffm);font-size:9px;color:var(--muted);white-space:nowrap}

/* ‚îÄ‚îÄ GAME TAB ‚îÄ‚îÄ */
.game-wrap{background:var(--card);border:1px solid rgba(168,85,247,0.2);border-radius:20px;padding:22px;margin-bottom:20px;text-align:center;position:relative;overflow:hidden}
.game-wrap::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 50% 0%,rgba(124,58,237,0.08),transparent 60%);pointer-events:none}

.game-hud{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:8px}
.hud-item{text-align:center}
.hud-val{font-family:var(--ffm);font-size:18px;font-weight:700;color:var(--xp2)}
.hud-label{font-size:10px;color:var(--muted);font-family:var(--ffm);letter-spacing:0.1em}
.hud-streak .hud-val{color:var(--gold)}
.hud-acc .hud-val{color:var(--green)}

.game-q-num{font-family:var(--ffm);font-size:10px;letter-spacing:0.2em;color:var(--muted);margin-bottom:12px;text-transform:uppercase}
.game-q{
  background:rgba(255,255,255,0.03);border:1px solid var(--border);
  border-radius:14px;padding:18px;margin-bottom:16px;
  font-size:15px;font-weight:700;line-height:1.5;color:var(--text);text-align:left;
}
.game-context{
  background:rgba(0,191,255,0.04);border:1px solid rgba(0,191,255,0.1);
  border-radius:10px;padding:12px;margin-bottom:18px;
  font-size:12px;color:#5a7a9a;line-height:1.7;text-align:left;
}
.game-context strong{color:var(--blue)}

.opts-grid{display:flex;flex-direction:column;gap:9px;margin-bottom:16px}
.opt-btn{
  width:100%;padding:13px 16px;border-radius:12px;border:1.5px solid var(--border);
  background:var(--card2);color:var(--text);font-family:var(--ff);font-size:13px;font-weight:600;
  cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:12px;text-align:left;
}
.opt-btn:hover:not(:disabled){border-color:rgba(168,85,247,0.4);background:rgba(124,58,237,0.08);transform:translateX(4px)}
.opt-btn.correct{border-color:var(--green);background:rgba(0,230,118,0.08);color:var(--green)}
.opt-btn.wrong{border-color:var(--red);background:rgba(255,69,96,0.08);color:var(--red)}
.opt-btn:disabled{cursor:default}
.opt-btn:disabled:not(.correct):not(.wrong){opacity:0.45}
.opt-letter{
  width:28px;height:28px;border-radius:8px;background:var(--dim);
  display:flex;align-items:center;justify-content:center;
  font-family:var(--ffm);font-size:11px;font-weight:700;flex-shrink:0;transition:all 0.2s;
}
.opt-btn.correct .opt-letter{background:var(--green);color:var(--bg)}
.opt-btn.wrong .opt-letter{background:var(--red);color:white}

.game-result{
  border-radius:14px;padding:16px;font-size:13px;line-height:1.7;
  display:none;animation:fadeSlide 0.3s ease;text-align:left;margin-bottom:12px;
}
.game-result.show{display:block}
.game-result.right{background:rgba(0,230,118,0.07);border:1px solid rgba(0,230,118,0.2);color:#a0e8c0}
.game-result.wrong{background:rgba(255,69,96,0.07);border:1px solid rgba(255,69,96,0.2);color:#ffa0b0}
.game-result strong{color:var(--text)}

.xp-pop{
  position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
  font-family:var(--ffm);font-size:32px;font-weight:700;
  pointer-events:none;opacity:0;color:var(--gold);
}
.xp-pop.fire{animation:xpFly 1s ease forwards}
@keyframes xpFly{
  0%{opacity:0;transform:translate(-50%,-100%) scale(0.5)}
  30%{opacity:1;transform:translate(-50%,-120%) scale(1.3)}
  100%{opacity:0;transform:translate(-50%,-180%) scale(1)}
}

.next-q-btn{
  padding:11px 28px;border-radius:12px;border:1px solid rgba(168,85,247,0.3);
  background:rgba(124,58,237,0.1);color:var(--xp2);font-family:var(--ffm);
  font-size:11px;letter-spacing:0.1em;cursor:pointer;transition:all 0.2s;
  display:none;
}
.next-q-btn:hover{background:rgba(124,58,237,0.2)}
.next-q-btn.show{display:inline-block}

/* SCORE BOARD */
.score-summary{
  background:var(--card2);border:1px solid rgba(168,85,247,0.15);
  border-radius:16px;padding:22px;text-align:center;display:none;
}
.score-summary.show{display:block;animation:fadeSlide 0.4s ease}
.ss-trophy{font-size:56px;animation:bounce 1s ease}
@keyframes bounce{0%,100%{transform:scale(1)}50%{transform:scale(1.15)}}
.ss-title{font-family:var(--ffh);font-size:24px;font-weight:700;color:var(--gold);margin:10px 0 4px}
.ss-sub{font-size:13px;color:var(--muted);margin-bottom:20px}
.ss-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:20px}
.ss-stat{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px;text-align:center}
.ss-val{font-family:var(--ffm);font-size:22px;font-weight:700;color:var(--text)}
.ss-label{font-size:11px;color:var(--muted);margin-top:2px}
.replay-btn{padding:12px 28px;border-radius:12px;border:1px solid rgba(245,200,66,0.3);background:rgba(245,200,66,0.08);color:var(--gold);font-family:var(--ffm);font-size:11px;letter-spacing:0.1em;cursor:pointer;transition:all 0.2s}
.replay-btn:hover{background:rgba(245,200,66,0.15)}

/* LEARN TAB */
.learn-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px}
.learn-card{
  background:var(--card2);border:1px solid var(--border);border-radius:14px;padding:16px;
  cursor:pointer;transition:all 0.25s;
}
.learn-card:hover{transform:translateY(-2px);border-color:rgba(255,255,255,0.12)}
.lc-icon{font-size:28px;margin-bottom:8px}
.lc-title{font-size:13px;font-weight:700;margin-bottom:4px}
.lc-sub{font-size:11px;color:var(--muted);line-height:1.4}
.lc-badge{display:inline-block;margin-top:8px;font-family:var(--ffm);font-size:9px;letter-spacing:0.1em;padding:2px 7px;border-radius:4px;background:rgba(124,58,237,0.1);color:var(--xp2)}

/* LESSON MODAL */
#lesson-modal{
  position:fixed;inset:0;z-index:500;
  background:rgba(0,0,0,0.85);backdrop-filter:blur(16px);
  display:flex;align-items:center;justify-content:center;
  opacity:0;pointer-events:none;transition:opacity 0.3s;padding:18px;
}
#lesson-modal.show{opacity:1;pointer-events:all}
.lesson-box{
  background:var(--card);border:1px solid rgba(168,85,247,0.2);
  border-radius:22px;padding:28px;max-width:520px;width:100%;
  max-height:88vh;overflow-y:auto;
  transform:translateY(20px);transition:transform 0.35s cubic-bezier(0.34,1.56,0.64,1);
}
#lesson-modal.show .lesson-box{transform:translateY(0)}
.lb-icon{font-size:48px;margin-bottom:12px}
.lb-title{font-family:var(--ffh);font-size:22px;font-weight:700;letter-spacing:0.06em;color:var(--gold);margin-bottom:16px}
.lb-body{font-size:14px;color:#7080a0;line-height:1.85}
.lb-body strong{color:var(--text);font-weight:700}
.lb-body h3{color:var(--xp2);font-family:var(--ffm);font-size:11px;letter-spacing:0.15em;text-transform:uppercase;margin:18px 0 6px;display:flex;align-items:center;gap:8px}
.lb-body h3::before{content:'';width:14px;height:1px;background:var(--xp2)}
.lb-body .example-box{background:rgba(124,58,237,0.06);border:1px solid rgba(124,58,237,0.15);border-radius:10px;padding:12px;margin:10px 0;font-size:13px;color:#8090b8}
.lb-close{margin-top:20px;padding:11px 24px;border-radius:12px;border:1px solid var(--border);background:var(--card2);color:var(--text);font-family:var(--ffm);font-size:11px;letter-spacing:0.1em;cursor:pointer;transition:all 0.2s;width:100%}
.lb-close:hover{border-color:var(--xp2);color:var(--xp2)}

/* LEVEL UP TOAST */
#lvl-toast{
  position:fixed;top:70px;left:50%;transform:translateX(-50%) translateY(-20px);
  z-index:1000;background:linear-gradient(135deg,var(--xp),var(--xp2));
  border-radius:20px;padding:12px 24px;display:flex;align-items:center;gap:10px;
  opacity:0;transition:all 0.4s cubic-bezier(0.34,1.56,0.64,1);pointer-events:none;
  box-shadow:0 8px 32px rgba(124,58,237,0.4);
}
#lvl-toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.lt-icon{font-size:22px}
.lt-text{font-family:var(--ffh);font-size:16px;font-weight:700;color:white;letter-spacing:0.06em}
.lt-sub{font-size:11px;color:rgba(255,255,255,0.7)}

/* RESPONSIVE */
@media(max-width:500px){
  .price-row{grid-template-columns:1fr 1fr}
  .learn-grid{grid-template-columns:1fr}
  .ss-grid{grid-template-columns:repeat(3,1fr)}
  .game-q{font-size:14px}
  .arenas-grid{grid-template-columns:1fr 1fr}
}
@media(max-width:360px){
  .arenas-grid{grid-template-columns:1fr}
  .price-row{grid-template-columns:1fr}
}
</style>
</head>
<body>
<div class="orb orb1"></div>
<div class="orb orb2"></div>

<!-- LEVEL UP TOAST -->
<div id="lvl-toast">
  <span class="lt-icon">‚ö°</span>
  <div><div class="lt-text" id="lt-text">LEVEL UP!</div><div class="lt-sub" id="lt-sub">You reached Level 2</div></div>
</div>

<!-- LESSON MODAL -->
<div id="lesson-modal" onclick="closelesson()">
  <div class="lesson-box" onclick="event.stopPropagation()">
    <div class="lb-icon" id="lb-icon"></div>
    <div class="lb-title" id="lb-title"></div>
    <div class="lb-body" id="lb-body"></div>
    <button class="lb-close" onclick="closelesson()">Got it ‚Äî close lesson ‚úì</button>
  </div>
</div>

<!-- TOPBAR -->
<div id="topbar" style="display:none;">
  <!-- LEFT: Logo + Username -->
  <div style="display:flex;align-items:center;gap:14px;">
    <div class="tb-logo">WORLD IQ</div>
    <div id="tb-username" style="
      font-size:11px;
      color:var(--muted);
      font-family:var(--ffm);
      letter-spacing:0.08em;
    ">
      Guest
    </div>
  </div>

  <!-- CENTER: XP -->
  <div class="tb-mid">
    <div class="xp-wrap">
      <div class="xp-label">XP</div>
      <div class="xp-bar">
        <div class="xp-fill" id="xp-fill" style="width:0%"></div>
      </div>
      <div class="xp-val" id="xp-val">0</div>
    </div>
  </div>

  <!-- RIGHT: Level + Streak + Clock + Logout -->
  <div style="display:flex;align-items:center;gap:10px">

    <div class="level-badge" onclick="showLvlModal()">
      <span class="lv-icon">‚ö°</span>
      <span class="lv-num" id="lv-num">1</span>
      <span class="lv-label">LVL</span>
    </div>

    <div class="streak-badge" onclick="showStreakInfo()">
      <span class="str-fire">üî•</span>
      <span class="str-num" id="str-num">1</span>
    </div>

    <div id="topbar-clock" style="
      font-family:var(--ffm);
      font-size:10px;
      color:var(--muted);
    "></div>

    <!-- LOGOUT BUTTON -->
    <button onclick="logout()" style="
      padding:6px 12px;
      border-radius:8px;
      border:1px solid var(--border);
      background:var(--card2);
      color:var(--text);
      font-family:var(--ffm);
      font-size:10px;
      letter-spacing:0.08em;
      cursor:pointer;
      transition:all 0.2s;
    " onmouseover="this.style.borderColor='var(--red)';this.style.color='var(--red)';"
      onmouseout="this.style.borderColor='var(--border)';this.style.color='var(--text)';">
      LOGOUT
    </button>

  </div>
</div>

<!-- AUTH SCREEN -->
<div id="auth-screen" style="display:flex;align-items:center;justify-content:center;height:100vh;padding:20px;">
  <div style="
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 40px 32px;
    width: 100%;
    max-width: 380px;
    text-align: center;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  ">
    <div style="
      font-family: var(--ffh);
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 6px;
      letter-spacing: 0.06em;
    ">
      WORLD IQ
    </div>

    <div style="
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 28px;
      letter-spacing: 0.1em;
      text-transform: uppercase;
    ">
      Login to continue
    </div>

    <input type="text" id="username" placeholder="Username" style="
      width:100%;
      padding:12px;
      margin-bottom:12px;
      border-radius:10px;
      border:1px solid var(--border);
      background: var(--card2);
      color: var(--text);
      font-family: var(--ff);
    ">

    <input type="email" id="email" placeholder="Email" style="
      width:100%;
      padding:12px;
      margin-bottom:12px;
      border-radius:10px;
      border:1px solid var(--border);
      background: var(--card2);
      color: var(--text);
      font-family: var(--ff);
    ">

    <input type="password" id="password" placeholder="Password" style="
      width:100%;
      padding:12px;
      margin-bottom:20px;
      border-radius:10px;
      border:1px solid var(--border);
      background: var(--card2);
      color: var(--text);
      font-family: var(--ff);
    ">

    <button id="signup-btn" type="button" onclick="signup()" style="display:block;
      width:100%;
      padding:12px;
      margin-bottom:10px;
      border-radius:12px;
      border:1px solid rgba(168,85,247,0.4);
      background: linear-gradient(135deg,var(--xp),var(--xp2));
      color:white;
      font-family: var(--ffm);
      font-size:11px;
      letter-spacing:0.1em;
      cursor:pointer;
    ">
      CREATE ACCOUNT
    </button>

    <button id="login-btn" type="button" onclick="login()" style="display:none;
      width:100%;
      padding:12px;
      border-radius:12px;
      border:1px solid var(--border);
      background: var(--card2);
      color: var(--text);
      font-family: var(--ffm);
      font-size:11px;
      letter-spacing:0.1em;
      cursor:pointer;
    ">
      LOGIN
    </button>
    <div style="
  margin-top:18px;
  font-size:11px;
  color:var(--muted);
  font-family:var(--ffm);
">
  Already have an account?
  <span onclick="switchToLogin()" style="
    color:var(--xp2);
    cursor:pointer;
  ">Login</span>
  &nbsp;|&nbsp;
  New user?
  <span onclick="switchToSignup()" style="
    color:var(--xp2);
    cursor:pointer;
  ">Register</span>
</div>
  </div>
</div>

<!-- HOME SCREEN -->
<div id="homescreen" style="display:none;">

  <div class="home-hero">
    <div class="home-greeting" id="home-greeting">Good morning</div>
    <div class="home-title">Learn <span>everything</span><br>about your world</div>
    <div class="home-sub">Pick an arena. Play, learn, earn XP. Beat yesterday's you.</div>
  </div>

  <!-- DAILY QUEST -->
  <div class="quest-bar">
    <div class="quest-icon">üéØ</div>
    <div class="quest-content">
      <div class="quest-title">Daily Quest ‚Äî Complete 2 arenas</div>
      <div class="quest-sub">You've visited <span id="quest-count">0</span> of 2 today</div>
      <div class="quest-progress-wrap">
        <div class="quest-prog-bar"><div class="quest-prog-fill" id="quest-fill" style="width:0%"></div></div>
        <div class="quest-pct" id="quest-pct">0%</div>
      </div>
    </div>
    <div class="quest-reward">+150 XP</div>
  </div>

  <!-- ARENAS -->
  <div class="arenas-label">Choose Your Arena</div>
  <div class="arenas-grid">
    <div class="arena-card arena-gold" onclick="openArena('gold')">
      <div class="arena-emoji">ü•á</div>
      <div class="arena-name">Gold & Silver</div>
      <div class="arena-sub">Prices, reasons, forecasts & prediction games</div>
      <div class="arena-footer">
        <div class="arena-xp-badge">+50 XP/game</div>
        <div class="arena-streak" id="gold-streak">‚Üë Hot today</div>
      </div>
    </div>
    <div class="arena-card arena-india" onclick="openArena('india')">
      <div class="arena-emoji">üáÆüá≥</div>
      <div class="arena-name">India</div>
      <div class="arena-sub">Economy, politics, markets, culture</div>
      <div class="arena-footer">
        <div class="arena-xp-badge">+50 XP/game</div>
        <div class="arena-streak">GDP: 8.4%</div>
      </div>
    </div>
    <div class="arena-card arena-world" onclick="openArena('world')">
      <div class="arena-emoji">üåê</div>
      <div class="arena-name">World</div>
      <div class="arena-sub">Geopolitics, global events, nations</div>
      <div class="arena-footer">
        <div class="arena-xp-badge">+50 XP/game</div>
        <div class="arena-streak">4 hot stories</div>
      </div>
    </div>
    <div class="arena-card arena-tech" onclick="openArena('tech')">
      <div class="arena-emoji">‚ö°</div>
      <div class="arena-name">Tech & AI</div>
      <div class="arena-sub">AI, startups, chips, future tech</div>
      <div class="arena-footer">
        <div class="arena-xp-badge">+50 XP/game</div>
        <div class="arena-streak">üî• Trending</div>
      </div>
    </div>
    <div class="arena-card arena-markets" onclick="openArena('markets')">
      <div class="arena-emoji">üìà</div>
      <div class="arena-name">Markets</div>
      <div class="arena-sub">Stocks, crypto, indices, investing</div>
      <div class="arena-footer">
        <div class="arena-xp-badge">+50 XP/game</div>
        <div class="arena-streak">Sensex +0.43%</div>
      </div>
    </div>
    <div class="arena-card arena-science" onclick="openArena('science')">
      <div class="arena-emoji">üß¨</div>
      <div class="arena-name">Science</div>
      <div class="arena-sub">Space, physics, biology, discoveries</div>
      <div class="arena-footer">
        <div class="arena-xp-badge">+50 XP/game</div>
        <div class="arena-streak">New mission!</div>
      </div>
    </div>
  </div>

  <!-- ACHIEVEMENTS -->
  <div class="arenas-label">Achievements</div>
  <div class="achieve-row">
    <div class="achieve" onclick="showAchieve('First Step','You opened WORLD IQ for the first time. Every expert was once a beginner.')">
      <div class="achieve-icon">üöÄ</div><div class="achieve-name">First Step</div>
    </div>
    <div class="achieve" id="ach-quiz" onclick="showAchieve('Quiz Master','Answered 5 questions correctly. Your financial IQ is growing!')">
      <div class="achieve-icon">üß†</div><div class="achieve-name">Quiz Master</div>
    </div>
    <div class="achieve locked" id="ach-streak">
      <div class="achieve-icon">üî•</div><div class="achieve-name">On Fire</div>
    </div>
    <div class="achieve locked" id="ach-gold">
      <div class="achieve-icon">ü•á</div><div class="achieve-name">Gold Expert</div>
    </div>
    <div class="achieve locked" id="ach-all">
      <div class="achieve-icon">üåç</div><div class="achieve-name">World Class</div>
    </div>
    <div class="achieve locked">
      <div class="achieve-icon">üíé</div><div class="achieve-name">Diamond IQ</div>
    </div>
  </div>

</div>

<!-- ARENA SCREEN -->
<div id="arenascreen">
  <div class="arena-topbar">
    <button class="back-btn" onclick="goHome()">‚Üê</button>
    <div class="arena-top-info">
      <div class="arena-top-name" id="arena-top-name">Gold & Silver</div>
      <div class="arena-top-sub" id="arena-top-sub">Prices ¬∑ Forecast ¬∑ Game ¬∑ Learn</div>
    </div>
    <div class="arena-top-xp" id="arena-xp-display">+0 XP today</div>
  </div>

  <div class="inner-tabs" id="inner-tabs">
    <button class="itab active" onclick="switchInner(0)">üìä Live</button>
    <button class="itab" onclick="switchInner(1)">ü§î Why?</button>
    <button class="itab" onclick="switchInner(2)">üîÆ Forecast</button>
    <button class="itab" onclick="switchInner(3)">üéÆ Game</button>
    <button class="itab" onclick="switchInner(4)">üìö Learn</button>
  </div>

  <div class="arena-content">

    <!-- LIVE TAB -->
    <div class="ipanel active" id="ip0">
      <div id="live-content"></div>
    </div>

    <!-- WHY TAB -->
    <div class="ipanel" id="ip1">
      <div id="why-content"></div>
    </div>

    <!-- FORECAST TAB -->
    <div class="ipanel" id="ip2">
      <div id="forecast-content"></div>
    </div>

    <!-- GAME TAB -->
    <div class="ipanel" id="ip3">
      <div id="game-content"></div>
    </div>

    <!-- LEARN TAB -->
    <div class="ipanel" id="ip4">
      <div id="learn-content"></div>
    </div>

  </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SUPABASE CONFIGURATION - GLOBAL SCOPE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SUPABASE_URL = "https://cnerthaoxsgawokaultj.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNuZXJ0aGFveHNnYXdva2F1bHRqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2ODI0MjEsImV4cCI6MjA4NzI1ODQyMX0.j59L0Q7j-nbIQSY_NS4c2_cqoB0lrNJkzbjvWIHhlPg";

// Immediate validation before anything else
console.log("=== SUPABASE INITIALIZATION DEBUG ===");
console.log("1. Constants defined:");
console.log("   SUPABASE_URL type:", typeof SUPABASE_URL);
console.log("   SUPABASE_URL value:", SUPABASE_URL);
console.log("   SUPABASE_URL length:", SUPABASE_URL.length);
console.log("   SUPABASE_URL starts with https://:", SUPABASE_URL.startsWith("https://"));
console.log("   SUPABASE_ANON_KEY type:", typeof SUPABASE_ANON_KEY);
console.log("   SUPABASE_ANON_KEY length:", SUPABASE_ANON_KEY.length);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SUPABASE INITIALIZATION WITH RETRY LOGIC
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function initSupabase() {
  try {
    if (!window.supabase || !window.supabase.createClient) {
      throw new Error("Supabase library not loaded.");
    }
    window.supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
      auth: { persistSession: true, autoRefreshToken: true, detectSessionInUrl: false }
    });
    console.log("‚úÖ Supabase initialized successfully.");
  } catch (err) {
    console.error("Supabase init error:", err);
  }
}
initSupabase();

function switchToLogin() {
  document.getElementById("username").style.display = "none";
  document.getElementById("signup-btn").style.display = "none";
  document.getElementById("login-btn").style.display = "block";
}

function switchToSignup() {
  document.getElementById("username").style.display = "block";
  document.getElementById("signup-btn").style.display = "block";
  document.getElementById("login-btn").style.display = "none";
}
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UI STATE MANAGEMENT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê==
function showAuth() {
  document.getElementById("auth-screen").style.display = "flex";
  document.getElementById("homescreen").style.display = "none";
  document.getElementById("topbar").style.display = "none";
}

function showApp(username) {
  document.getElementById("auth-screen").style.display = "none";
  document.getElementById("homescreen").style.display = "block";
  document.getElementById("topbar").style.display = "flex";
  document.getElementById("tb-username").innerText = username || "Player";
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const S = {
  xp: parseInt(localStorage.getItem('wiq_xp')||'0'),
  level: parseInt(localStorage.getItem('wiq_level')||'1'),
  streak: (()=>{
    const d=JSON.parse(localStorage.getItem('wiq_streak')||'{"count":1,"last":""}');
    const t=new Date().toDateString();
    if(d.last===t) return d.count;
    d.count = d.last===new Date(Date.now()-86400000).toDateString() ? d.count+1 : 1;
    d.last=t; localStorage.setItem('wiq_streak',JSON.stringify(d)); return d.count;
  })(),
  questCount: parseInt(sessionStorage.getItem('wiq_quest')||'0'),
  arenaXP: 0,
  gameScore: 0,
  gameQ: 0,
  gameStreak: 0,
  gameCorrect: 0,
  currentArena: 'gold',
  visitedArenas: new Set(),
  totalCorrect: parseInt(localStorage.getItem('wiq_correct')||'0'),
};

const XP_PER_LEVEL = 200;

function saveState(){
  localStorage.setItem('wiq_xp', S.xp);
  localStorage.setItem('wiq_level', S.level);
  localStorage.setItem('wiq_correct', S.totalCorrect);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DYNAMIC DATA ENGINE
// All prices, news, and context fetched fresh each session.
// Free APIs only ‚Äî no API keys required.
// Cache: localStorage, TTL: 30min for prices, 60min for news
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const CACHE_TTL_PRICES = 30 * 60 * 1000;   // 30 min
const CACHE_TTL_NEWS   = 60 * 60 * 1000;   // 60 min
const USD_TO_INR = 83.5; // approximate ‚Äî updated via API below

// ‚îÄ‚îÄ Utility: cache with TTL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function cacheSet(key, data, ttl) {
  localStorage.setItem(key, JSON.stringify({ ts: Date.now(), ttl, data }));
}
function cacheGet(key) {
  try {
    const raw = localStorage.getItem(key);
    if (!raw) return null;
    const obj = JSON.parse(raw);
    if (Date.now() - obj.ts > obj.ttl) return null;
    return obj.data;
  } catch { return null; }
}

// ‚îÄ‚îÄ Shared loading skeleton ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function skeleton(lines = 3) {
  return Array(lines).fill('<div class="price-loading" style="height:14px;margin-bottom:8px;display:block;border-radius:6px"></div>').join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// 1. GOLD & SILVER ‚Äî api.metals.live (free, no key)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function getMetalPrices() {
  const cached = cacheGet('dyn_metals');
  if (cached) return cached;
  try {
    const res = await fetch('https://api.metals.live/v1/spot', { signal: AbortSignal.timeout(7000) });
    const arr = await res.json();
    const data = {};
    arr.forEach(item => Object.assign(data, item));
    cacheSet('dyn_metals', data, CACHE_TTL_PRICES);
    return data;
  } catch(e) {
    console.warn('[WIQ] metals API failed', e);
    return cacheGet('dyn_metals') || { gold: 2034, silver: 22.8, palladium: 1000, platinum: 950 };
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// 2. STOCK QUOTES ‚Äî Yahoo Finance (free, no key, via allorigins proxy)
// Symbols: ^BSESN=Sensex, ^NSEI=Nifty, BTC-USD, NVDA, TCS.NS, INFY.NS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function getQuote(symbol) {
  const key = `dyn_q_${symbol}`;
  const cached = cacheGet(key);
  if (cached) return cached;
  try {
    const url = `https://query1.finance.yahoo.com/v8/finance/chart/${encodeURIComponent(symbol)}?interval=1d&range=2d`;
    const proxy = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;
    const res = await fetch(proxy, { signal: AbortSignal.timeout(8000) });
    const json = await res.json();
    const chart = JSON.parse(json.contents).chart.result[0];
    const meta = chart.meta;
    const price = meta.regularMarketPrice;
    const prev  = meta.previousClose || meta.chartPreviousClose;
    const chg   = price - prev;
    const pct   = (chg / prev * 100);
    const data  = { price, prev, chg, pct, currency: meta.currency, symbol };
    cacheSet(key, data, CACHE_TTL_PRICES);
    return data;
  } catch(e) {
    console.warn('[WIQ] Yahoo quote failed for', symbol, e);
    return null;
  }
}

// Helper to format a quote as a price-card HTML
function fmtQuote(q, label, sub, color) {
  if (!q) return `<div class="pc-price">${skeleton(1)}</div>`;
  const up = q.chg >= 0;
  const sign = up ? '‚ñ≤ +' : '‚ñº ';
  const priceStr = q.currency === 'INR'
    ? '‚Çπ' + Math.round(q.price).toLocaleString('en-IN')
    : q.currency === 'USD'
    ? '$' + q.price.toLocaleString('en-US', { maximumFractionDigits: 2 })
    : q.price.toLocaleString();
  const chgStr = q.currency === 'INR'
    ? `${sign}${Math.abs(Math.round(q.chg)).toLocaleString('en-IN')} (${up?'+':''}${q.pct.toFixed(2)}%)`
    : `${sign}${Math.abs(q.chg).toFixed(2)} (${up?'+':''}${q.pct.toFixed(2)}%)`;
  return `
    <div class="pc-tag" style="color:${color}">${label}</div>
    <div class="pc-price">${priceStr}</div>
    <div class="pc-sub">${sub}</div>
    <div class="pc-change ${up?'up':'dn'}">${chgStr}</div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// 3. NEWS ‚Äî RSS via rss2json (free tier, no key needed for low volume)
// Fallback: static curated stories if RSS fails
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const RSS_FEEDS = {
  india:   'https://economictimes.indiatimes.com/markets/rssfeeds/1977021501.cms',
  world:   'https://feeds.feedburner.com/ndtvnews-world-news',
  tech:    'https://techcrunch.com/feed/',
  markets: 'https://economictimes.indiatimes.com/markets/stocks/rssfeeds/2146842.cms',
  science: 'https://www.sciencenews.org/feed',
};

const FALLBACK_NEWS = {
  india: [
    { title:'India GDP growth remains among fastest globally', desc:'Economy continues to outperform G20 peers driven by manufacturing and services', tag:'ECONOMY' },
    { title:'Sensex and Nifty react to global market moves', desc:'FII flows and global cues drive Indian equity markets daily', tag:'MARKETS' },
    { title:'RBI policy meeting outcome watched closely', desc:'Rate decisions impact EMIs, bond yields and rupee value', tag:'RBI' },
    { title:'Indian IT sector wins global AI contracts', desc:'Infosys, TCS, Wipro secure multi-year AI transformation deals', tag:'TECH' },
  ],
  world: [
    { title:'US Federal Reserve holds interest rate decision', desc:'Rate outlook drives global capital flows and emerging market currencies', tag:'USA' },
    { title:'China economy data impacts commodity demand outlook', desc:'Industrial output numbers move oil, copper and metals globally', tag:'CHINA' },
    { title:'EU regulatory moves reshape global tech landscape', desc:'New rules affect AI companies and data privacy standards', tag:'EUROPE' },
    { title:'Middle East tensions affect oil prices', desc:'Geopolitical risk premium built into crude oil and gold', tag:'GULF' },
  ],
  tech: [
    { title:'AI chip demand continues to surge worldwide', desc:'NVIDIA and semiconductor stocks reflect unprecedented AI infrastructure spending', tag:'AI' },
    { title:'Indian AI startups raise record funding', desc:'Sarvam, Krutrim and others building India-specific language models', tag:'INDIA AI' },
    { title:'OpenAI and Google release next-gen models', desc:'Competition in foundation AI models intensifies across all fronts', tag:'AI' },
    { title:'Global tech M&A activity picks up pace', desc:'Large acquisitions signal confidence in long-term tech growth', tag:'DEALS' },
  ],
  markets: [
    { title:'Global equities track US earnings season', desc:'Corporate results drive sector rotation and index moves worldwide', tag:'EQUITIES' },
    { title:'Bitcoin and crypto markets react to macro data', desc:'Crypto correlates increasingly with risk appetite and dollar strength', tag:'CRYPTO' },
    { title:'Commodity markets driven by supply-demand shifts', desc:'Oil, metals and agri-commodities move on global data releases', tag:'COMMODITIES' },
    { title:'Bond yields signal inflation and rate expectations', desc:'Fixed income markets often lead equity movements by weeks', tag:'BONDS' },
  ],
  science: [
    { title:'ISRO advances India space mission milestones', desc:'Indian space programme accelerates with commercial and government launches', tag:'SPACE' },
    { title:'CRISPR gene therapy trials show promising results', desc:'Gene editing technology moves closer to treating hereditary diseases', tag:'BIO' },
    { title:'Fusion energy research achieves new milestone', desc:'Scientists push closer to commercially viable clean fusion power', tag:'ENERGY' },
    { title:'AI accelerates drug discovery timelines dramatically', desc:'Machine learning cuts years from pharmaceutical development process', tag:'AI+BIO' },
  ],
};

async function getNews(arena) {
  const key = `dyn_news_${arena}`;
  const cached = cacheGet(key);
  if (cached) return cached;
  try {
    const feedUrl = RSS_FEEDS[arena];
    const api = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feedUrl)}&count=5`;
    const res = await fetch(api, { signal: AbortSignal.timeout(8000) });
    const json = await res.json();
    if (json.status !== 'ok') throw new Error('RSS error');
    const items = json.items.slice(0, 5).map(item => ({
      title: item.title.replace(/<[^>]*>/g,'').substring(0, 80),
      desc: (item.description || item.content || '').replace(/<[^>]*>/g,'').substring(0, 100).trim(),
      tag: (item.categories && item.categories[0]) ? item.categories[0].toUpperCase().substring(0,10) : arena.toUpperCase(),
      link: item.link,
    }));
    cacheSet(key, items, CACHE_TTL_NEWS);
    return items;
  } catch(e) {
    console.warn('[WIQ] RSS failed for', arena, e);
    return FALLBACK_NEWS[arena] || [];
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DYNAMIC LIVE TAB RENDERERS
// Each arena fetches its data and renders
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const today = () => new Date().toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' });

// Pick emoji for news items based on tag keywords
function newsEmoji(title, tag) {
  const t = (title + tag).toLowerCase();
  if (t.includes('space')||t.includes('isro')||t.includes('nasa')||t.includes('rocket')) return 'üöÄ';
  if (t.includes('ai')||t.includes('artificial')) return 'ü§ñ';
  if (t.includes('crypto')||t.includes('bitcoin')||t.includes('btc')) return '‚Çø';
  if (t.includes('gold')||t.includes('silver')) return 'ü•á';
  if (t.includes('oil')||t.includes('crude')) return 'üõ¢Ô∏è';
  if (t.includes('rbi')||t.includes('bank')||t.includes('rate')) return 'üè¶';
  if (t.includes('india')||t.includes('indian')) return 'üáÆüá≥';
  if (t.includes('usa')||t.includes('fed')||t.includes('dollar')) return 'üá∫üá∏';
  if (t.includes('china')) return 'üá®üá≥';
  if (t.includes('europe')||t.includes('eu')) return 'üá™üá∫';
  if (t.includes('gene')||t.includes('crispr')||t.includes('bio')) return 'üß¨';
  if (t.includes('energy')||t.includes('solar')||t.includes('fusion')) return '‚òÄÔ∏è';
  if (t.includes('tech')||t.includes('chip')) return 'üíª';
  if (t.includes('market')||t.includes('stock')||t.includes('sensex')) return 'üìà';
  return 'üì∞';
}

// ‚îÄ‚îÄ GOLD ARENA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function renderGoldLive(container) {
  container.innerHTML = `
    <div class="card-label" style="color:var(--gold)">‚óÜ Live Prices ‚Äî ${today()}</div>
    <div class="price-row">
      <div class="price-card gold-c"><div id="dyn-gold-card">${skeleton(4)}</div></div>
      <div class="price-card silver-c"><div id="dyn-silver-card">${skeleton(4)}</div></div>
    </div>
    <div class="chart-wrap">
      <div class="chart-header">
        <div class="chart-title">Price Chart</div>
        <div class="range-btns">
          <button class="rb act" onclick="switchRange(this,'7d')">7D</button>
          <button class="rb" onclick="switchRange(this,'1m')">1M</button>
          <button class="rb" onclick="switchRange(this,'3m')">3M</button>
          <button class="rb" onclick="switchRange(this,'1y')">1Y</button>
        </div>
      </div>
      <canvas id="priceChart"></canvas>
      <div class="chart-legend">
        <div class="cl-item"><div class="cl-dot" style="background:var(--gold)"></div>Gold (‚Çπ/10g)</div>
        <div class="cl-item"><div class="cl-dot" style="background:var(--silver)"></div>Silver (‚Çπ/kg √∑ 10)</div>
      </div>
    </div>
    <div class="card" style="border-color:rgba(245,200,66,0.15)" id="dyn-metal-snapshot">
      <div class="card-accent" style="background:linear-gradient(90deg,var(--gold),var(--gold2))"></div>
      <div class="card-label" style="color:var(--gold)">‚óÜ Market Snapshot</div>
      ${skeleton(3)}
    </div>`;

  setTimeout(drawChart, 100);

  const metals = await getMetalPrices();
  const goldUsd = metals.gold || 2034;
  const silverUsd = metals.silver || 22.8;
  const palladiumUsd = metals.palladium || 1000;
  const platinumUsd = metals.platinum || 950;

  const goldInr  = Math.round(goldUsd * USD_TO_INR / 31.1035 * 10);
  const silverInr = Math.round(silverUsd * USD_TO_INR * 32.1507);
  const gsRatio = (goldUsd / silverUsd).toFixed(1);

  // Determine trend
  const trend = goldUsd > 2000 ? 'BULL üü¢' : goldUsd > 1800 ? 'NEUTRAL üü°' : 'BEAR üî¥';

  document.getElementById('dyn-gold-card').innerHTML = `
    <div class="pc-tag"><span class="pc-dot" style="background:var(--gold)"></span><span style="color:var(--gold)">GOLD</span></div>
    <div class="pc-price">‚Çπ${goldInr.toLocaleString('en-IN')}</div>
    <div class="pc-sub">per 10 grams (MCX approx.)</div>
    <div class="pc-change up">Live spot rate</div>
    <div class="pc-intl">Global: $${goldUsd.toFixed(2)}/oz</div>`;

  document.getElementById('dyn-silver-card').innerHTML = `
    <div class="pc-tag"><span class="pc-dot" style="background:var(--silver)"></span><span style="color:var(--silver)">SILVER</span></div>
    <div class="pc-price">‚Çπ${silverInr.toLocaleString('en-IN')}</div>
    <div class="pc-sub">per kg (MCX approx.)</div>
    <div class="pc-change up">Live spot rate</div>
    <div class="pc-intl">Global: $${silverUsd.toFixed(2)}/oz</div>`;

  document.getElementById('dyn-metal-snapshot').innerHTML = `
    <div class="card-accent" style="background:linear-gradient(90deg,var(--gold),var(--gold2))"></div>
    <div class="card-label" style="color:var(--gold)">‚óÜ Market Snapshot</div>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;text-align:center">
      <div>
        <div style="font-family:var(--ffm);font-size:16px;font-weight:700;color:var(--gold)">$${goldUsd.toFixed(0)}</div>
        <div style="font-size:11px;color:var(--muted);margin-top:3px">Gold Spot/oz</div>
      </div>
      <div>
        <div style="font-family:var(--ffm);font-size:16px;font-weight:700;color:var(--silver)">${gsRatio}:1</div>
        <div style="font-size:11px;color:var(--muted);margin-top:3px">Gold/Silver Ratio</div>
      </div>
      <div>
        <div style="font-family:var(--ffm);font-size:16px;font-weight:700;color:var(--green)">${trend}</div>
        <div style="font-size:11px;color:var(--muted);margin-top:3px">Trend Signal</div>
      </div>
    </div>
    <div style="margin-top:12px;display:grid;grid-template-columns:1fr 1fr;gap:8px">
      <div style="background:var(--dim);border-radius:8px;padding:8px;text-align:center">
        <div style="font-family:var(--ffm);font-size:13px;font-weight:700;color:var(--text)">$${platinumUsd.toFixed(0)}</div>
        <div style="font-size:10px;color:var(--muted)">Platinum/oz</div>
      </div>
      <div style="background:var(--dim);border-radius:8px;padding:8px;text-align:center">
        <div style="font-family:var(--ffm);font-size:13px;font-weight:700;color:var(--text)">$${palladiumUsd.toFixed(0)}</div>
        <div style="font-size:10px;color:var(--muted)">Palladium/oz</div>
      </div>
    </div>`;

  // Update forecast NOW price too
  window._liveGold = { goldUsd, silverUsd, goldInr, silverInr, gsRatio };
}

// ‚îÄ‚îÄ INDIA ARENA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function renderIndiaLive(container) {
  container.innerHTML = `
    <div class="card-label" style="color:var(--orange)">‚óÜ India Today ‚Äî ${today()}</div>
    <div class="price-row">
      <div class="price-card" style="border-color:rgba(255,140,66,0.2)"><div id="dyn-sensex-card">${skeleton(4)}</div></div>
      <div class="price-card" style="border-color:rgba(255,140,66,0.2)"><div id="dyn-nifty-card">${skeleton(4)}</div></div>
    </div>
    <div class="card"><div class="card-label" style="color:var(--orange)">‚óÜ Top India Stories</div>
    <div id="dyn-india-news">${skeleton(5)}</div></div>`;

  // Fetch in parallel
  const [sensex, nifty, news] = await Promise.all([
    getQuote('^BSESN'),
    getQuote('^NSEI'),
    getNews('india'),
  ]);

  document.getElementById('dyn-sensex-card').innerHTML = sensex
    ? fmtQuote(sensex, 'SENSEX', 'BSE ¬∑ Live', 'var(--orange)')
    : `<div class="pc-tag" style="color:var(--orange)">SENSEX</div><div class="pc-sub">Data unavailable</div>`;

  document.getElementById('dyn-nifty-card').innerHTML = nifty
    ? fmtQuote(nifty, 'NIFTY 50', 'NSE ¬∑ Live', 'var(--orange)')
    : `<div class="pc-tag" style="color:var(--orange)">NIFTY</div><div class="pc-sub">Data unavailable</div>`;

  document.getElementById('dyn-india-news').innerHTML =
    news.map(n => makeNewsItem(newsEmoji(n.title, n.tag), n.title, n.desc || '', n.tag)).join('');
}

// ‚îÄ‚îÄ WORLD ARENA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function renderWorldLive(container) {
  container.innerHTML = `
    <div class="card-label" style="color:var(--green)">‚óÜ World Today ‚Äî ${today()}</div>
    <div class="price-row">
      <div class="price-card" style="border-color:rgba(0,191,255,0.2)"><div id="dyn-usd-card">${skeleton(3)}</div></div>
      <div class="price-card" style="border-color:rgba(255,140,66,0.2)"><div id="dyn-crude-card">${skeleton(3)}</div></div>
    </div>
    <div class="card"><div class="card-label" style="color:var(--green)">‚óÜ World Headlines</div>
    <div id="dyn-world-news">${skeleton(5)}</div></div>`;

  const [dxy, crude, news] = await Promise.all([
    getQuote('DX-Y.NYB'),       // Dollar Index
    getQuote('CL=F'),           // Crude Oil Futures
    getNews('world'),
  ]);

  document.getElementById('dyn-usd-card').innerHTML = dxy
    ? fmtQuote(dxy, 'DOLLAR INDEX (DXY)', 'USD strength ¬∑ Live', 'var(--blue)')
    : `<div class="pc-tag" style="color:var(--blue)">DXY</div><div class="pc-sub">Data unavailable</div>`;

  document.getElementById('dyn-crude-card').innerHTML = crude
    ? fmtQuote(crude, 'CRUDE OIL (WTI)', '$/barrel ¬∑ NYMEX', 'var(--orange)')
    : `<div class="pc-tag" style="color:var(--orange)">CRUDE OIL</div><div class="pc-sub">Data unavailable</div>`;

  document.getElementById('dyn-world-news').innerHTML =
    news.map(n => makeNewsItem(newsEmoji(n.title, n.tag), n.title, n.desc || '', n.tag)).join('');
}

// ‚îÄ‚îÄ TECH ARENA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function renderTechLive(container) {
  container.innerHTML = `
    <div class="card-label" style="color:var(--xp2)">‚óÜ Tech Pulse ‚Äî ${today()}</div>
    <div class="price-row">
      <div class="price-card" style="border-color:rgba(168,85,247,0.2)"><div id="dyn-nvda-card">${skeleton(4)}</div></div>
      <div class="price-card" style="border-color:rgba(168,85,247,0.2)"><div id="dyn-tcs-card">${skeleton(4)}</div></div>
    </div>
    <div class="price-row">
      <div class="price-card" style="border-color:rgba(168,85,247,0.2)"><div id="dyn-infy-card">${skeleton(4)}</div></div>
      <div class="price-card" style="border-color:rgba(168,85,247,0.2)"><div id="dyn-msft-card">${skeleton(4)}</div></div>
    </div>
    <div class="card"><div class="card-label" style="color:var(--xp2)">‚óÜ Tech Headlines</div>
    <div id="dyn-tech-news">${skeleton(5)}</div></div>`;

  const [nvda, tcs, infy, msft, news] = await Promise.all([
    getQuote('NVDA'),
    getQuote('TCS.NS'),
    getQuote('INFY.NS'),
    getQuote('MSFT'),
    getNews('tech'),
  ]);

  document.getElementById('dyn-nvda-card').innerHTML = fmtQuote(nvda, 'NVIDIA', 'AI Chip King ¬∑ NASDAQ', 'var(--xp2)');
  document.getElementById('dyn-tcs-card').innerHTML = fmtQuote(tcs, 'TCS', 'Tata Consultancy ¬∑ NSE', 'var(--xp2)');
  document.getElementById('dyn-infy-card').innerHTML = fmtQuote(infy, 'INFOSYS', 'IT Services ¬∑ NSE', 'var(--xp2)');
  document.getElementById('dyn-msft-card').innerHTML = fmtQuote(msft, 'MICROSOFT', 'Azure + AI ¬∑ NASDAQ', 'var(--xp2)');

  document.getElementById('dyn-tech-news').innerHTML =
    news.map(n => makeNewsItem(newsEmoji(n.title, n.tag), n.title, n.desc || '', n.tag)).join('');
}

// ‚îÄ‚îÄ MARKETS ARENA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function renderMarketsLive(container) {
  container.innerHTML = `
    <div class="card-label" style="color:var(--blue)">‚óÜ Market Pulse ‚Äî ${today()}</div>
    <div class="price-row">
      <div class="price-card" style="border-color:rgba(0,191,255,0.2)"><div id="dyn-sensex2-card">${skeleton(4)}</div></div>
      <div class="price-card" style="border-color:rgba(0,191,255,0.2)"><div id="dyn-btc-card">${skeleton(4)}</div></div>
    </div>
    <div class="card"><div class="card-label" style="color:var(--blue)">‚óÜ Key Stocks & Indices</div>
    <div id="dyn-stocks-list">${skeleton(4)}</div></div>
    <div class="card"><div class="card-label" style="color:var(--blue)">‚óÜ Market Headlines</div>
    <div id="dyn-markets-news">${skeleton(4)}</div></div>`;

  const [sensex, btc, hdfc, dixon, tatapower, news] = await Promise.all([
    getQuote('^BSESN'),
    getQuote('BTC-USD'),
    getQuote('HDFCBANK.NS'),
    getQuote('DIXON.NS'),
    getQuote('TATAPOWER.NS'),
    getNews('markets'),
  ]);

  document.getElementById('dyn-sensex2-card').innerHTML = fmtQuote(sensex, 'SENSEX', 'BSE ¬∑ Live', 'var(--blue)');
  document.getElementById('dyn-btc-card').innerHTML = fmtQuote(btc, 'BITCOIN', 'BTC/USD ¬∑ Crypto', 'var(--orange)');

  const stocks = [hdfc, dixon, tatapower].map((q, i) => {
    if (!q) return '';
    const names = ['HDFC Bank', 'Dixon Tech', 'Tata Power'];
    const reasons = ['India\'s largest private bank', 'Apple/Samsung contracts', 'Renewable energy play'];
    const up = q.chg >= 0;
    const badge = up ? 'BUY' : 'HOLD';
    return makeStockRow(q.symbol.replace('.NS',''), names[i],
      '‚Çπ' + Math.round(q.price).toLocaleString('en-IN'),
      `${up?'+':''}${q.pct.toFixed(2)}%`, up, badge, reasons[i]);
  }).join('');
  document.getElementById('dyn-stocks-list').innerHTML = stocks || skeleton(3);

  document.getElementById('dyn-markets-news').innerHTML =
    news.map(n => makeNewsItem(newsEmoji(n.title, n.tag), n.title, n.desc || '', n.tag)).join('');
}

// ‚îÄ‚îÄ SCIENCE ARENA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function renderScienceLive(container) {
  container.innerHTML = `
    <div class="card-label" style="color:var(--red)">‚óÜ Science This Week ‚Äî ${today()}</div>
    <div class="price-row">
      <div class="price-card" style="border-color:rgba(255,69,96,0.2)"><div id="dyn-spce-card">${skeleton(3)}</div></div>
      <div class="price-card" style="border-color:rgba(255,69,96,0.2)"><div id="dyn-bio-card">${skeleton(3)}</div></div>
    </div>
    <div class="card"><div class="card-label" style="color:var(--red)">‚óÜ Science Headlines</div>
    <div id="dyn-science-news">${skeleton(5)}</div></div>`;

  const [spce, mrna, news] = await Promise.all([
    getQuote('SPCE'),     // Virgin Galactic (space proxy)
    getQuote('MRNA'),     // Moderna (biotech proxy)
    getNews('science'),
  ]);

  document.getElementById('dyn-spce-card').innerHTML = spce
    ? fmtQuote(spce, 'SPACE SECTOR', 'Virgin Galactic ¬∑ NYSE', 'var(--red)')
    : `<div class="pc-tag" style="color:var(--red)">SPACE SECTOR</div><div style="font-size:11px;padding:4px">Proxy: SPCE ¬∑ Space tourism & innovation stocks</div>`;

  document.getElementById('dyn-bio-card').innerHTML = mrna
    ? fmtQuote(mrna, 'BIOTECH', 'Moderna ¬∑ NASDAQ', 'var(--red)')
    : `<div class="pc-tag" style="color:var(--red)">BIOTECH</div><div style="font-size:11px;padding:4px">CRISPR & gene therapy development sector</div>`;

  document.getElementById('dyn-science-news').innerHTML =
    news.map(n => makeNewsItem(newsEmoji(n.title, n.tag), n.title, n.desc || '', n.tag)).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ARENA DATA ‚Äî static quiz/learn/why/forecast preserved
// live() now calls async renderers above
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const ARENAS = {

  gold: {
    name: 'ü•á Gold & Silver',
    sub: 'Precious Metals Intelligence',
    color: '#f5c842',
    live: (container) => renderGoldLive(container),
    why: () => `
      <div class="card-label" style="color:var(--gold)">‚óÜ Why did Gold & Silver move today?</div>
      ${makeWhyCard('üè¶','Fed Rate Cut Signals','US Dollar Weakens','BULLISH',
        `<span class="tag" style="background:rgba(0,230,118,0.1);color:var(--green)">KEY DRIVER</span>
        The US Federal Reserve signalled <strong>2 interest rate cuts in 2025</strong>. When US rates fall, the dollar weakens. Since gold is priced in dollars globally, a <strong>weaker dollar = gold gets cheaper for the rest of the world = more demand = higher price</strong>.`)}
      ${makeWhyCard('‚ö†Ô∏è','Geopolitical Tension','Middle East & Russia-Ukraine conflict','BULLISH',
        `Gold is called a <strong>"safe haven asset"</strong> ‚Äî when the world feels uncertain, people move money FROM risky assets (stocks) INTO gold. It's like insurance for your wealth.
        <br><br>Historically, <strong>every major conflict since 1970 has pushed gold up 10‚Äì30%</strong> within 3 months.`)}
      ${makeWhyCard('üá®üá≥','China & India Buying','Central Banks accumulate gold reserves','BULLISH',
        `In 2024, <strong>China's central bank bought 735 tonnes of gold</strong>. India's RBI also added 65 tonnes. Central banks buy gold to reduce dependence on the US dollar (called "de-dollarization").`)}
      ${makeWhyCard('üè≠','Industrial Demand for Silver','EVs & Solar panels need silver','BULLISH',
        `Silver isn't just jewellery ‚Äî it's a <strong>critical industrial metal</strong>. Every solar panel needs silver paste. Every electric vehicle has silver contacts.
        <br><br>India's target: 500GW solar by 2030. Each GW of solar uses ~30 tonnes of silver.`)}
      ${makeWhyCard('üí∞','Dollar Index (DXY)','DXY and Gold move inversely','BULLISH',
        `The DXY measures USD strength. <strong>Rule of thumb:</strong> DXY up ‚Üí Gold down. DXY down ‚Üí Gold up. They move in almost perfect opposition about 80% of the time.`)}
    `,
    forecast: () => `
      <div class="card-label" style="color:var(--xp2)">‚óÜ Price Forecast ‚Äî Analyst Consensus</div>
      <div class="card" style="border-color:rgba(168,85,247,0.2);margin-bottom:20px">
        <div style="background:rgba(124,58,237,0.06);border:1px solid rgba(124,58,237,0.12);border-radius:10px;padding:12px;font-size:12px;color:#6070a0;margin-bottom:16px">
          ‚ö†Ô∏è <strong style="color:var(--text)">Disclaimer:</strong> Forecasts are analyst consensus & macro models. Not financial advice.
        </div>
        <div class="ft-wrap">
          <div class="ft-line-vert"></div>
          ${makeFT('NOW (Today)', window._liveGold ? '‚Çπ'+window._liveGold.goldInr.toLocaleString('en-IN') : 'Live price', window._liveGold ? '$'+window._liveGold.goldUsd.toFixed(2)+'/oz' : 'See Live tab', '‚Äî','',
            'Current price. Check the Live tab for real-time data.', 95, true)}
          ${makeFT('1 MONTH','Target: +2‚Äì4%','Analyst consensus','',true,
            'Fed rate cut expectations building. Dollar weakening trend continues. Watch DXY closely.',78,false)}
          ${makeFT('3 MONTHS','Target: +5‚Äì10%','Seasonal buying in India','',true,
            'Monsoon season typically raises Indian gold buying. US election uncertainty historically spikes gold.',72,false)}
          ${makeFT('6 MONTHS','Target: +10‚Äì18%','Bull cycle mid-phase','',true,
            'Fed rate cuts likely begin Q3. Geopolitical tensions unpredictable. Solar/EV industrial demand for silver accelerating.',65,false)}
          ${makeFT('1 YEAR','Target: +18‚Äì30%','Long-term bull case','',true,
            'Continued de-dollarization, central bank buying, inflation hedge demand.',58,false)}
        </div>
      </div>
      <div class="card" style="border-color:rgba(200,216,238,0.15)">
        <div class="card-label" style="color:var(--silver)">‚óÜ Silver Forecast</div>
        <div class="ft-wrap">
          <div class="ft-line-vert" style="background:linear-gradient(to bottom,var(--silver),rgba(200,216,238,0.1))"></div>
          ${makeFT('NOW', window._liveGold ? '‚Çπ'+window._liveGold.silverInr.toLocaleString('en-IN')+'/kg':'Live price', 'Gold/Silver ratio: '+(window._liveGold?window._liveGold.gsRatio:'see Live'),'‚Äî','','Historical avg ratio: 60:1. When ratio is elevated, silver tends to catch up.',85,true)}
          ${makeFT('6 MONTHS','Target: +15‚Äì25%','Solar demand surge','',true,
            'India\'s renewable energy expansion. Silver typically outperforms gold in the second half of bull cycles.',70,false)}
        </div>
      </div>`,
    questions: [
      {
        q: "Gold is priced in US Dollars globally. Today the US Dollar got WEAKER. What happens to gold's price?",
        ctx: "üí° Gold is bought and sold globally in USD. When the dollar weakens, foreign currencies can buy more dollars ‚Äî and therefore more gold ‚Äî with the same amount of local money.",
        opts:["Gold price stays the same","Gold price DROPS because dollar weakened","Gold price RISES because a weaker dollar = more demand from non-US buyers","Impossible to predict"],
        ans:2, xp:50,
        explain:"‚úÖ A weaker dollar makes gold cheaper for buyers in India, Europe, China etc. They buy more ‚Üí higher demand ‚Üí price rises. This is why Gold and the Dollar Index (DXY) almost always move in OPPOSITE directions."
      },
      {
        q: "If you had ‚Çπ1 lakh in 1990, and kept it as cash vs buying gold ‚Äî what's the difference today?",
        ctx: "üí° India's inflation since 1990 has eroded purchasing power significantly. Meanwhile gold has risen ~20x in nominal terms.",
        opts:["Cash: ‚Çπ1L ‚Üí still ‚Çπ1L | Gold: ‚Çπ1L ‚Üí ‚Çπ8L","Cash: ‚Çπ1L ‚Üí ‚Çπ3L | Gold: ‚Çπ1L ‚Üí ‚Çπ15L","Cash: ‚Çπ1L ‚Üí ‚Çπ4,200 real value | Gold: ‚Çπ1L ‚Üí ‚Çπ40L+","They would be equal due to bank interest"],
        ans:2, xp:60,
        explain:"‚úÖ Inflation destroyed the purchasing power of cash. But gold bought in 1990 at ~‚Çπ3,200/10g has grown ~20x in nominal terms, far outpacing inflation."
      },
      {
        q: "Silver's price has been rising because of ONE big trend in technology. Which one?",
        ctx: "üí° Silver is a critical industrial metal used in electronics, solar panels, and electric vehicles ‚Äî all growing sectors.",
        opts:["Smartphones (silver in circuit boards)","Solar panels & electric vehicles (silver paste & contacts)","Satellites (silver wiring in space)","AI servers (silver cooling systems)"],
        ans:1, xp:50,
        explain:"‚úÖ Every solar panel uses silver paste for conductivity. Every EV uses silver in battery contacts and circuits. India's 500GW solar target = ~15,000 tonnes of silver demand by 2030."
      },
      {
        q: "Gold is called a 'Safe Haven'. If there's a major geopolitical crisis tomorrow, what should you EXPECT?",
        ctx: "üí° Safe haven assets are things investors run TO when scared ‚Äî they hold value or rise when everything else falls.",
        opts:["Gold drops ‚Äî people sell everything in panic","Gold stays flat ‚Äî wars don't affect commodities","Gold RISES ‚Äî fear increases demand for safe haven assets","Gold is banned during crises"],
        ans:2, xp:50,
        explain:"‚úÖ Every major conflict since 1970 has pushed gold up. The 2022 Russia-Ukraine war: gold jumped 8% in 2 weeks. When uncertainty rises, gold shines."
      },
      {
        q: "The Gold-Silver ratio is historically 60:1 on average. When it's at 89:1, what does this signal?",
        ctx: "üí° The Gold-Silver ratio tells you how many ounces of silver it takes to buy 1 ounce of gold. High ratio = silver is relatively cheap.",
        opts:["Gold is too cheap ‚Äî sell silver, buy gold","Silver is relatively cheap ‚Äî it may outperform gold going forward","The ratio means gold will fall 89% soon","Both metals will rise equally"],
        ans:1, xp:70,
        explain:"‚úÖ When the ratio is high vs historical 60:1, silver is relatively undervalued. In past cycles, silver rises FASTER than gold when the ratio reverts. This is the 'silver catch-up trade'."
      }
    ],
    learn: [
      {icon:'üè¶',title:'Why Central Banks Buy Gold',sub:'The secret war against the US Dollar',badge:'Beginner',
       body:`<h3>The Big Picture</h3>Since 1971, the US dollar has been the world's "reserve currency" ‚Äî all global trade (oil, wheat, chips) is priced in USD. This gives America enormous power.<br><br><strong>Countries are quietly fighting back</strong> by buying gold instead of holding US dollars as reserves.
       <h3>Who's buying?</h3>In 2024:<br>‚Ä¢ China: 735 tonnes<br>‚Ä¢ India (RBI): 65 tonnes<br>‚Ä¢ Poland: 90 tonnes<br>‚Ä¢ Turkey: 75 tonnes<br><br>This is called <strong>"de-dollarization"</strong> ‚Äî reducing dependence on the US.
       <h3>Why does this push gold UP?</h3>When central banks buy hundreds of tonnes, they remove supply from the market. Less supply + same demand = higher price.
       <div class="example-box">üáÆüá≥ <strong>India angle:</strong> RBI now holds 800+ tonnes of gold. They recently brought 100 tonnes back from Bank of England storage to India. This signals confidence in gold's long-term role.</div>`},
      {icon:'‚ö°',title:'Gold vs Inflation',sub:'The ultimate rupee destroyer explained',badge:'Beginner',
       body:`<h3>What is Inflation Really?</h3>Every year, the government prints more money. More money chasing the same goods = prices rise. This is inflation.
       <h3>The Rule</h3>Gold doesn't "earn" money like a business. But it holds REAL value over time. It's insurance against currency destruction.
       <div class="example-box">üí° <strong>Practical tip:</strong> Keep 10-15% of your wealth in gold (ideally Sovereign Gold Bonds for 2.5% interest bonus). Use it as your financial foundation, not your growth engine.</div>`},
      {icon:'‚òÄÔ∏è',title:'Silver & The Green Revolution',sub:'How solar panels & EVs are making silver scarce',badge:'Intermediate',
       body:`<h3>Silver is More Than Jewellery</h3>About 50% of all silver demand is now industrial:<br>‚Ä¢ <strong>Solar panels:</strong> Each panel uses ~20g of silver paste<br>‚Ä¢ <strong>Electric vehicles:</strong> Each EV uses 25-50g of silver<br>‚Ä¢ <strong>Electronics:</strong> Every smartphone has ~0.3g of silver.
       <div class="example-box">üìà <strong>Investment angle:</strong> Silver ETFs (like SilverBees on NSE) give pure silver exposure. In bull markets, silver often rises 2-3x more than gold due to its smaller market size.</div>`},
    ]
  },

  india: {
    name:'üáÆüá≥ India Arena', sub:'Economy ¬∑ Politics ¬∑ Culture ¬∑ Markets', color:'#ff8c42',
    live: (container) => renderIndiaLive(container),
    why:()=>`<div class="card-label" style="color:var(--orange)">‚óÜ Why India's economy is growing</div>
      ${makeWhyCard('üè≠','Manufacturing Boom (PLI Scheme)','‚Çπ2L Cr incentives boosting production','BULLISH','India\'s <strong>Production-Linked Incentive</strong> scheme gives cash back to companies that manufacture in India. Apple now makes 14% of iPhones here. Dixon makes Samsung TVs.<br><br>This created 1.8 million new factory jobs in 2024 alone. More jobs ‚Üí more spending ‚Üí economy grows.')}
      ${makeWhyCard('üë•','Demographic Dividend','65% of India is under 35','BULLISH','India adds <strong>~1 million new workers to the labour force every month</strong>. Compare: Japan is aging and shrinking. China\'s workforce peaked.<br><br>Young workers = producers AND consumers. This demographic tailwind will power India\'s growth for 20+ years.')}
      ${makeWhyCard('üíª','IT Services Boom','AI is creating more work, not less','BULLISH','Every global company upgrading to AI needs Indian engineers to implement it. Infosys, TCS, Wipro are winning massive AI transformation contracts.<br><br>Indian IT export revenue: <strong>$250B in FY24</strong> ‚Äî up 11% YoY.')}
    `,
    forecast:()=>`<div class="card-label" style="color:var(--xp2)">‚óÜ India Economic Outlook</div>
      <div class="card"><div class="ft-wrap"><div class="ft-line-vert"></div>
      ${makeFT('2025','GDP: 7.8‚Äì8.5%','Sensex target: 82,000+','','',
        'IMF projects India as fastest G20 economy. RBI likely to cut rates once in H2 ‚Äî boosting markets.',80,true)}
      ${makeFT('2026‚Äì27','GDP: 8‚Äì9%','‚Çπ100L Cr economy','','',
        'India\'s middle class expanding by 40M people/year. Infrastructure spending highest ever. Digital economy doubling.',70,false)}
      ${makeFT('2030','$5 Trillion Economy','3rd largest globally','','',
        'Target: Overtake Japan and Germany. Manufacturing + services + digital = diversified growth engine.',60,false)}
      </div></div>`,
    questions:[
      {q:"India's GDP consistently grows above 7%. What does GDP actually measure?",ctx:"üí° GDP = Gross Domestic Product. It measures the total value of everything produced in a country in a year.",
       opts:["How much gold a country has","Total value of all goods & services produced","How happy citizens are","Government tax collection"],
       ans:1,xp:40,explain:"‚úÖ GDP measures the total economic output. Think of India as a factory ‚Äî GDP is the total value of everything that factory produced in a year. Higher GDP = more production = more jobs = more prosperity."},
      {q:"When RBI CUTS the repo rate, what happens to HOME LOAN EMIs?",ctx:"üí° Repo rate = the rate RBI charges banks for borrowing money. Banks use this as a baseline for all loans they give.",
       opts:["Home loan rates go UP","Home loan rates stay the same","Home loan rates go DOWN ‚Äî banks borrow cheaper, pass savings on","Home loans get banned temporarily"],
       ans:2,xp:50,explain:"‚úÖ When RBI cuts the repo rate, banks can borrow from RBI more cheaply. They pass savings to customers. Your EMI on a ‚Çπ50L home loan could drop by ‚Çπ2,000‚Äì3,000/month after a 0.5% rate cut."},
    ],
    learn:[
      {icon:'üè¶',title:'How RBI Controls Your Money',sub:'The most powerful institution in India',badge:'Beginner',
       body:`<h3>What is RBI?</h3>The Reserve Bank of India is India's central bank. It controls the money supply, sets interest rates, and regulates all banks.
       <h3>The Repo Rate ‚Äî India's Lever</h3>The repo rate is RBI's main tool. When they raise it, borrowing gets expensive ‚Äî economy cools (fights inflation). When they cut it, borrowing gets cheap ‚Äî economy heats up.
       <div class="example-box">üè† <strong>Your life example:</strong> RBI cuts rate 0.5% ‚Üí your bank's rate drops ‚Üí on a ‚Çπ50L loan, you save ‚Çπ2,500/month ‚Üí ‚Çπ30,000/year ‚Üí ‚Çπ5L over a 15-year loan. That's real money from one RBI meeting.</div>`},
    ]
  },

  world:{name:'üåê World Arena',sub:'Geopolitics ¬∑ Global Events ¬∑ Nations',color:'#00e676',
    live: (container) => renderWorldLive(container),
    why:()=>`<div class="card-label" style="color:var(--green)">‚óÜ Why the world moved today</div>
    ${makeWhyCard('üè¶','Fed Rate Decisions','US rates drive global capital flows','BULLISH','When the US Fed cuts rates, global capital flows OUT of US treasuries and INTO emerging markets like India. More foreign money coming into India = rupee strengthens, stock market rises.')}
    ${makeWhyCard('ü§ñ','China AI Competition','DeepSeek challenges US AI dominance','NEUTRAL','China\'s AI models like DeepSeek proved frontier AI is achievable at low cost. This is bearish for expensive US AI models but bullish for adoption ‚Äî cheaper AI = everyone uses it.')}
    ${makeWhyCard('‚öñÔ∏è','Global Regulation Wave','AI, data privacy, trade ‚Äî new rules reshaping economies','NEUTRAL','From EU AI Act to India\'s data protection law, governments worldwide are setting rules for the digital economy. Companies that comply early win long-term.')}`,
    forecast:()=>`<div class="card-label" style="color:var(--xp2)">‚óÜ Global Outlook 2025</div>
    <div class="card"><div class="ft-wrap"><div class="ft-line-vert"></div>
    ${makeFT('Q2 2025','Fed first rate cut expected','Dollar weakens 3-5%','','','Emerging markets rally. India, Brazil, Indonesia benefit most. Gold, oil could spike.',75,true)}
    ${makeFT('Q3 2025','US market volatility likely','Election uncertainty','','','Markets typically more volatile in political uncertainty periods. Gold rises as safe haven.',65,false)}
    ${makeFT('2026','AI regulation goes global','EU rules adopted widely','','','Most countries adopt AI regulations. Companies that comply early win. India building its own framework.',60,false)}
    </div></div>`,
    questions:[
      {q:"When the US Fed raises interest rates, what typically happens to the Indian stock market?",ctx:"üí° Global capital is mobile ‚Äî investors move money to wherever returns are highest. US interest rates directly affect how much money flows into India.",
       opts:["Sensex goes UP ‚Äî more money flows to India","Sensex is unaffected ‚Äî India is independent","Sensex tends to go DOWN ‚Äî global money flows back to US","Sensex doubles automatically"],
       ans:2,xp:50,explain:"‚úÖ When US rates rise, US bonds become attractive. Foreign investors pull money OUT of 'risky' emerging markets like India and park it in US bonds. Less FII money in India = Sensex drops. This is why global rate decisions matter for YOUR portfolio."},
    ],
    learn:[
      {icon:'üåç',title:'How Global Events Affect Your Money',sub:'Everything is connected',badge:'Beginner',
       body:`<h3>The Butterfly Effect of Finance</h3>A war in the Middle East can raise your petrol price in Hyderabad within a week:
       <br><br>Conflict ‚Üí oil supply disruption ‚Üí global oil price rises ‚Üí India imports 85% of oil ‚Üí petrol price rises ‚Üí transport costs rise ‚Üí all goods cost more ‚Üí inflation rises ‚Üí RBI raises rates ‚Üí your EMI goes up.
       <h3>The Key Connections</h3>‚Ä¢ <strong>US Fed decisions</strong> ‚Üí Global capital flows ‚Üí India market<br>‚Ä¢ <strong>China growth</strong> ‚Üí Commodity demand ‚Üí Indian exporters<br>‚Ä¢ <strong>Middle East stability</strong> ‚Üí Oil price ‚Üí Indian inflation
       <div class="example-box">üí° <strong>Simple habit:</strong> Every time something big happens globally, ask: "Does this affect oil? The dollar? US interest rates?" If yes to any ‚Üí India is affected.</div>`},
    ]
  },

  tech:{name:'‚ö° Tech & AI Arena',sub:'AI ¬∑ Startups ¬∑ Chips ¬∑ Future',color:'#a855f7',
    live: (container) => renderTechLive(container),
    why:()=>`<div class="card-label" style="color:var(--xp2)">‚óÜ Why Tech moved today</div>
    ${makeWhyCard('üß†','AI Spending Boom','Every company buying AI infrastructure','BULLISH','Microsoft, Google, Amazon, Meta are spending $200B+ combined on AI infrastructure in 2025. This drives demand for NVIDIA chips, data centers, and cloud services. Indian IT companies win implementation contracts.')}
    ${makeWhyCard('üá®üá≥','China AI Competition','DeepSeek at 1/10th the cost','NEUTRAL','DeepSeek proved frontier AI is achievable at low cost. This is bearish for expensive US AI models but bullish for adoption ‚Äî cheaper AI = everyone uses it = more demand for Indian engineers.')}
    ${makeWhyCard('‚ö°','Chip Cycle Intensifies','Next-gen chip production confirmed','BULLISH','2nm chips are 30% faster and 25% more power efficient. India is in talks with TSMC for a chip fab. If successful, India could become a chip manufacturing nation ‚Äî transformational for the economy.')}`,
    forecast:()=>`<div class="card-label" style="color:var(--xp2)">‚óÜ Tech Outlook</div>
    <div class="card"><div class="ft-wrap"><div class="ft-line-vert"></div>
    ${makeFT('2025','AI becomes mainstream','100M+ new AI users in India','','','Jio AI, Sarvam, Krutrim reach mass adoption. Indian AI startups raise $5B+. IT sector revenue +15%.',80,true)}
    ${makeFT('2026','Humanoid robots enter factories','Physical AI goes commercial','','','Figure, Tesla Optimus in 1000+ factories. Indian IT companies managing robot fleets.',65,false)}
    ${makeFT('2030','AGI possible','AI surpasses human performance broadly','','','Most cognitive work AI-assisted. India positioned well ‚Äî large young population adapting fastest.',45,false)}
    </div></div>`,
    questions:[
      {q:"NVIDIA's stock rises when AI spending booms. Which Indian sector benefits MOST directly?",ctx:"üí° Think about what Indian companies do for global tech giants ‚Äî implementation, maintenance, and consulting.",
       opts:["Indian real estate (data centers need land)","Indian IT services ‚Äî Infosys, TCS, Wipro get AI contracts","Indian retail ‚Äî people buy more electronics","Indian agriculture ‚Äî AI used in farming"],
       ans:1,xp:50,explain:"‚úÖ Indian IT companies are the world's AI implementation army. Every Fortune 500 company upgrading to AI needs Indian engineers to integrate, customize, and maintain these systems. When AI spending rises globally ‚Üí Indian IT revenue rises ‚Üí stock prices of Infosys, TCS, Wipro go up."},
    ],
    learn:[
      {icon:'ü§ñ',title:'AI Explained Simply',sub:'What it actually is and why it matters to you',badge:'Beginner',
       body:`<h3>What IS Artificial Intelligence?</h3>AI is software that learns from examples instead of following fixed rules. Traditional software: "If X, do Y." AI: "Here are 1 million examples ‚Äî figure out the pattern yourself."
       <h3>How It Affects You Financially</h3>Companies using AI grow faster and cut costs ‚Üí their stocks rise ‚Üí if you hold their stocks or funds containing them, your wealth grows.
       <div class="example-box">üíº <strong>Indian opportunity:</strong> India has 5 million+ software engineers. AI makes each one 10x more productive. India's IT exports could hit $500B by 2030 (vs $250B today) because of AI multiplier effect.</div>`},
    ]
  },

  markets:{name:'üìà Markets Arena',sub:'Stocks ¬∑ Crypto ¬∑ Indices ¬∑ Investing',color:'#00bfff',
    live: (container) => renderMarketsLive(container),
    why:()=>`<div class="card-label" style="color:var(--blue)">‚óÜ Why markets moved today</div>
    ${makeWhyCard('üåç','FII Flows Drive Sensex','Foreign money = market direction','BULLISH','Foreign Institutional Investors are the biggest short-term driver of Indian markets. When FII flows are positive, Sensex rises. When they sell, it falls. Watch FII data daily at NSE website.')}
    ${makeWhyCard('üí∞','US Fed Rate Signals','Dollar impacts global flows','BULLISH','Fed rate cuts make US bonds less attractive. Money rotates into emerging markets. India is typically the top destination ‚Äî strong GDP, political stability. Every 0.25% Fed cut = ~‚Çπ1,000-2,000 Cr of FII inflow to India historically.')}
    ${makeWhyCard('üìä','Corporate Earnings Season','Quarterly results drive stocks','BULLISH','When Indian companies report strong quarterly earnings, their stocks go up. When 70%+ of Nifty 50 beats estimates, entire index rises. Track earnings season (Apr, Jul, Oct, Jan) closely.')}`,
    forecast:()=>`<div class="card-label" style="color:var(--xp2)">‚óÜ Market Targets 2025</div>
    <div class="card"><div class="ft-wrap"><div class="ft-line-vert"></div>
    ${makeFT('Q1 2025','Sensex: 74,000‚Äì78,000','Nifty: 22,500‚Äì23,500','','','Q4 earnings season begins. RBI rate cut expectations building.',75,true)}
    ${makeFT('Q2‚ÄìQ3 2025','Sensex: 78,000‚Äì84,000','Nifty: 23,500‚Äì25,500','','','Fed cuts rates ‚Äî FII inflows surge. Monsoon forecast critical for rural stocks.',68,false)}
    ${makeFT('End 2025','Sensex: 82,000‚Äì92,000','Nifty: 25,000‚Äì28,000','','','Full year: +15% to +25% return expected. Best sectors: IT, Banking, Renewable Energy, Defence.',60,false)}
    </div></div>`,
    questions:[
      {q:"You invest ‚Çπ5,000/month in a Nifty 50 index fund for 15 years at 13% average annual return. Roughly how much will you have?",ctx:"üí° This tests your understanding of SIP (Systematic Investment Plan) and compound interest ‚Äî the most powerful concept in personal finance.",
       opts:["‚Çπ9 lakhs (just what you put in)","‚Çπ22 lakhs (slightly more than invested)","‚Çπ1.2 crores (power of compounding)","‚Çπ5 crores (unrealistic)"],
       ans:2,xp:60,explain:"‚úÖ At 13% annualized returns (Nifty 50's historical average), ‚Çπ5,000/month for 15 years ‚Üí ~‚Çπ1.2 crore. You invested only ‚Çπ9 lakh. The other ‚Çπ1.1 crore is PURE compounding. Start TODAY."},
    ],
    learn:[
      {icon:'üìà',title:'SIP: The Most Powerful Habit in Finance',sub:'How ‚Çπ5,000/month becomes ‚Çπ1 crore',badge:'Beginner',
       body:`<h3>What is a SIP?</h3>SIP (Systematic Investment Plan) means automatically investing a fixed amount every month into a mutual fund ‚Äî regardless of whether markets are up or down. Set it, forget it, get rich slowly.
       <h3>The Numbers</h3>‚Çπ5,000/month √ó 15 years √ó 13% = ‚Çπ1.2 crore<br>‚Çπ5,000/month √ó 20 years √ó 13% = ‚Çπ2.6 crore<br>‚Çπ5,000/month √ó 30 years √ó 13% = ‚Çπ9.4 crore
       <div class="example-box">üöÄ <strong>Start in 5 minutes:</strong> Open Groww or Zerodha ‚Üí search "Nifty 50 Index Fund" ‚Üí set up ‚Çπ500/month SIP. Increase by 10% every year as your income grows.</div>`},
    ]
  },

  science:{name:'üß¨ Science Arena',sub:'Space ¬∑ Physics ¬∑ Biology ¬∑ Discovery',color:'#ff4560',
    live: (container) => renderScienceLive(container),
    why:()=>`<div class="card-label" style="color:var(--red)">‚óÜ Why these discoveries matter to you</div>
    ${makeWhyCard('üöÄ','Reusable Rocket Revolution','Cost to space drops 100x','BULLISH','SpaceX\'s Starship aims to reduce launch costs from $10,000/kg to $100/kg. This makes space commercially viable. Indian companies like Skyroot and Agnikul are riding this wave.')}
    ${makeWhyCard('üß¨','CRISPR Gene Editing','We can now rewrite DNA errors','BULLISH','CRISPR lets scientists edit genes like editing text. Curing hereditary blindness, sickle cell disease, certain cancers. India has 300M+ people with genetic diseases ‚Äî this could affect millions of lives here within a decade.')}
    ${makeWhyCard('‚òÄÔ∏è','Fusion Energy Progress','Unlimited clean energy on horizon','BULLISH','Fusion is how the sun generates energy. Q>1 means we got more energy out than we put in. Commercial fusion by 2035 could mean electricity too cheap to meter. India would benefit enormously.')}`,
    forecast:()=>`<div class="card-label" style="color:var(--xp2)">‚óÜ Science Horizon</div>
    <div class="card"><div class="ft-wrap"><div class="ft-line-vert"></div>
    ${makeFT('2025','Gaganyaan launches','India joins elite space nations','','','ISRO\'s first human spaceflight. Strategic + scientific milestone. Boosts India\'s space sector.',90,true)}
    ${makeFT('2026‚Äì28','CRISPR therapies approved','Genetic diseases curable','','','India-specific genetic diseases (thalassemia, sickle cell) likely first targets. Government funding accelerating.',70,false)}
    ${makeFT('2030‚Äì35','Fusion electricity possible','Energy becomes abundant','','','India investing in fusion research. If successful, eliminates energy insecurity permanently.',50,false)}
    </div></div>`,
    questions:[
      {q:"Fusion energy achieves Q>1 ‚Äî more energy OUT than put IN. Why is this a big deal?",ctx:"üí° Fusion is how the sun works ‚Äî hydrogen atoms merge to release enormous energy. Unlike nuclear fission, fusion produces no long-lived radioactive waste.",
       opts:["It makes bombs more powerful","It could provide unlimited clean energy with no carbon or nuclear waste","It gives unlimited internet speed","It makes computers faster"],
       ans:1,xp:50,explain:"‚úÖ Fusion energy could solve humanity's energy crisis permanently. The fuel is hydrogen (from water) ‚Äî virtually infinite. The output is helium ‚Äî harmless. No carbon emissions, no nuclear waste."},
    ],
    learn:[
      {icon:'üß¨',title:'CRISPR: The DNA Editor',sub:'How scientists are rewriting life',badge:'Beginner',
       body:`<h3>What is DNA?</h3>DNA is the instruction manual for every cell in your body ‚Äî 3 billion letters of code. Errors cause genetic diseases.
       <h3>What is CRISPR?</h3>CRISPR (Cas9) is a molecular "find and replace" tool. You program it with the faulty DNA sequence ‚Üí it finds it in the cell ‚Üí cuts it out ‚Üí the cell repairs itself. Like fixing a typo in a document.
       <h3>Why India Should Care</h3>India has 300M+ people with genetic disorders. Sickle cell disease affects 20M Indians. Thalassemia: 45 million carriers. CRISPR therapies could treat millions.
       <div class="example-box">üí∞ <strong>Investment angle:</strong> India's biotech sector (Sun Pharma, Biocon, Dr. Reddy's) are investing in gene therapy. Long-term 10-20 year bet.</div>`},
    ]
  }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function makeWhyCard(icon,title,sub,impact,body){
  const cls=impact==='BULLISH'?'imp-bull':impact==='BEARISH'?'imp-bear':'imp-neut';
  return `<div class="why-card" onclick="toggleWhy(this)">
    <div class="why-front">
      <div class="why-icon">${icon}</div>
      <div class="why-mid"><div class="why-title">${title}</div><div class="why-sub">${sub}</div></div>
      <div class="why-impact ${cls}">${impact}</div>
      <div class="why-chevron">‚ñæ</div>
    </div>
    <div class="why-body">${body}</div>
  </div>`;
}

function makeFT(period,price,sub,pct,up,reason,conf,now){
  const chgColor=up===true?'var(--green)':up===false?'var(--red)':'var(--muted)';
  return `<div class="ft-item">
    <div class="ft-dot${now?' now':''}"></div>
    <div class="ft-period">${period}</div>
    <div class="ft-price-row">
      <div class="ft-price">${price}</div>
      ${pct?`<div class="ft-chg" style="color:${chgColor}">${up?'‚ñ≤':'‚ñº'} ${pct}</div>`:''}
    </div>
    ${sub?`<div style="font-family:var(--ffm);font-size:11px;color:var(--muted);margin-bottom:4px">${sub}</div>`:''}
    <div class="ft-reason">${reason}</div>
    <div class="ft-conf-row">
      <div class="ft-cbar"><div class="ft-cfill" style="width:0%" data-w="${conf}"></div></div>
      <div class="ft-clabel">Confidence: ${conf}%</div>
    </div>
  </div>`;
}

function makeNewsItem(icon,title,sub,tag){
  return `<div style="display:flex;gap:12px;padding:12px 0;border-bottom:1px solid var(--border);align-items:flex-start">
    <div style="font-size:22px;flex-shrink:0;padding-top:2px">${icon}</div>
    <div style="flex:1">
      <div style="font-size:13px;font-weight:700;margin-bottom:3px;color:var(--text)">${title}</div>
      <div style="font-size:11px;color:var(--muted)">${sub}</div>
    </div>
    <div style="font-family:var(--ffm);font-size:9px;letter-spacing:0.1em;color:var(--muted);padding:2px 6px;background:var(--dim);border-radius:4px;flex-shrink:0">${tag}</div>
  </div>`;
}

function makeStockRow(sym,name,price,chg,up,badge,reason){
  const bc=badge==='BUY'?'background:rgba(0,230,118,0.08);color:var(--green);border:1px solid rgba(0,230,118,0.3)':'background:rgba(0,191,255,0.08);color:var(--blue);border:1px solid rgba(0,191,255,0.3)';
  return `<div style="display:flex;align-items:center;gap:10px;padding:11px 0;border-bottom:1px solid var(--border)">
    <div style="flex:1">
      <div style="display:flex;align-items:center;gap:8px">
        <span style="font-family:var(--ffm);font-size:13px;font-weight:700;color:var(--blue)">${sym}</span>
        <span style="font-family:var(--ffm);font-size:9px;padding:2px 7px;border-radius:4px;${bc}">${badge}</span>
      </div>
      <div style="font-size:11px;color:var(--muted);margin-top:2px">${name} ¬∑ ${reason}</div>
    </div>
    <div style="text-align:right;flex-shrink:0">
      <div style="font-family:var(--ffm);font-size:13px;font-weight:700">${price}</div>
      <div style="font-family:var(--ffm);font-size:11px;color:${up?'var(--green)':'var(--red)'}">${up?'‚ñ≤':'‚ñº'} ${chg}</div>
    </div>
  </div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// GAME ENGINE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let gState={q:0,score:0,streak:0,correct:0,answered:false,done:false};
let gQuestions=[];

function buildGame(){
  gState={q:0,score:0,streak:0,correct:0,answered:false,done:false};
  gQuestions=[...ARENAS[S.currentArena].questions];
  renderQ();
}

function renderQ(){
  const el=document.getElementById('game-content');
  if(gState.q>=gQuestions.length){showSummary();return;}
  const q=gQuestions[gState.q];
  const letters=['A','B','C','D'];
  el.innerHTML=`
    <div class="game-wrap" style="position:relative">
      <div class="game-hud">
        <div class="hud-item hud-score"><div class="hud-val" id="hud-score">${gState.score}</div><div class="hud-label">SCORE</div></div>
        <div class="hud-item"><div class="hud-val" style="color:var(--text)">${gState.q+1}/${gQuestions.length}</div><div class="hud-label">QUESTION</div></div>
        <div class="hud-item hud-streak"><div class="hud-val" id="hud-streak">${gState.streak}üî•</div><div class="hud-label">STREAK</div></div>
        <div class="hud-item hud-acc"><div class="hud-val" id="hud-acc">${gState.q>0?Math.round(gState.correct/gState.q*100):100}%</div><div class="hud-label">ACCURACY</div></div>
      </div>
      <div class="game-q-num">Question ${gState.q+1} of ${gQuestions.length} ¬∑ +${q.xp} XP</div>
      <div class="game-q">${q.q}</div>
      <div class="game-context">${q.ctx}</div>
      <div class="opts-grid" id="opts-grid">
        ${q.opts.map((o,i)=>`
          <button class="opt-btn" onclick="answerQ(${i})">
            <div class="opt-letter">${letters[i]}</div>
            <span>${o}</span>
          </button>`).join('')}
      </div>
      <div class="game-result" id="game-result"></div>
      <div style="position:relative">
        <button class="next-q-btn" id="next-btn" onclick="nextQ()">Next Question ‚Üí</button>
        <span class="xp-pop" id="xp-pop"></span>
      </div>
    </div>
    <div class="score-summary" id="score-summary"></div>`;
}

function answerQ(chosen){
  if(gState.answered) return;
  gState.answered=true;
  const q=gQuestions[gState.q];
  const opts=document.querySelectorAll('.opt-btn');
  const isRight=chosen===q.ans;
  opts.forEach((b,i)=>{
    b.disabled=true;
    if(i===q.ans) b.classList.add('correct');
    else if(i===chosen && !isRight) b.classList.add('wrong');
  });
  const res=document.getElementById('game-result');
  res.className='game-result show '+(isRight?'right':'wrong');
  res.innerHTML=(isRight?'‚úÖ ':'‚ùå ')+q.explain;
  if(isRight){
    gState.score+=q.xp; gState.correct++; gState.streak++;
    S.totalCorrect++; addXP(q.xp);
    const pop=document.getElementById('xp-pop');
    pop.textContent=`+${q.xp} XP`; pop.classList.add('fire');
    setTimeout(()=>pop.classList.remove('fire'),1100);
    document.getElementById('hud-score').textContent=gState.score;
    document.getElementById('hud-streak').textContent=gState.streak+'üî•';
  } else {
    gState.streak=0;
    document.getElementById('hud-streak').textContent='0üî•';
  }
  document.getElementById('hud-acc').textContent=
    Math.round(gState.correct/(gState.q+1)*100)+'%';
  document.getElementById('next-btn').classList.add('show');
}

function nextQ(){
  gState.q++; gState.answered=false;
  if(gState.q>=gQuestions.length) showSummary(); else renderQ();
}

function showSummary(){
  const el=document.getElementById('game-content');
  const pct=Math.round(gState.correct/gQuestions.length*100);
  const trophy=pct===100?'üèÜ':pct>=80?'ü•á':pct>=60?'ü•à':pct>=40?'ü•â':'üòÖ';
  const msg=pct===100?'PERFECT! Flawless!':pct>=80?'Excellent work!':pct>=60?'Good job! Keep learning.':pct>=40?'Not bad, review the lessons.':'Review the Learn tab!';
  saveState();
  el.innerHTML=`
    <div class="score-summary show">
      <div class="ss-trophy">${trophy}</div>
      <div class="ss-title">${msg}</div>
      <div class="ss-sub">${gState.correct}/${gQuestions.length} correct ¬∑ ${gState.score} XP earned today</div>
      <div class="ss-grid">
        <div class="ss-stat"><div class="ss-val">${gState.score}</div><div class="ss-label">XP Earned</div></div>
        <div class="ss-stat"><div class="ss-val">${pct}%</div><div class="ss-label">Accuracy</div></div>
        <div class="ss-stat"><div class="ss-val">${gState.streak}üî•</div><div class="ss-label">Best Streak</div></div>
      </div>
      <button class="replay-btn" onclick="buildGame()">üîÑ Play Again</button>
    </div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// XP & LEVELS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function addXP(amount){
  S.xp+=amount; S.arenaXP+=amount;
  const newLevel=Math.floor(S.xp/XP_PER_LEVEL)+1;
  if(newLevel>S.level){
    S.level=newLevel;
    showLevelUp(`You reached Level ${S.level}`);
  }
  updateXPBar(); saveState();
  document.getElementById('arena-xp-display').textContent=`+${S.arenaXP} XP today`;
}

function updateXPBar(){
  const pct=((S.xp%XP_PER_LEVEL)/XP_PER_LEVEL)*100;
  document.getElementById('xp-fill').style.width=pct+'%';
  document.getElementById('xp-val').textContent=S.xp;
  document.getElementById('lv-num').textContent=S.level;
  document.getElementById('str-num').textContent=S.streak;
}

function showLevelUp(msg){
  const t=document.getElementById('lvl-toast');
  document.getElementById('lt-sub').textContent=msg;
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),3000);
}

function showLvlModal(){
  const needed=(XP_PER_LEVEL-(S.xp%XP_PER_LEVEL));
  openLesson('‚ö°','Your Progress',
    `<h3>Current Status</h3><strong>Level ${S.level}</strong> ¬∑ ${S.xp} total XP<br>Need <strong>${needed} more XP</strong> to reach Level ${S.level+1}.
    <h3>How to Earn XP</h3>‚Ä¢ Correct quiz answer: +40‚Äì70 XP<br>‚Ä¢ Visiting a new arena: +20 XP<br>‚Ä¢ Completing daily quest: +150 XP<br>‚Ä¢ Daily streak bonus: +${S.streak*10} XP (current)
    <h3>Levels & Titles</h3>‚Ä¢ Level 1‚Äì3: Curious Beginner üå±<br>‚Ä¢ Level 4‚Äì7: Informed Citizen üì∞<br>‚Ä¢ Level 8‚Äì12: Market Aware üìä<br>‚Ä¢ Level 13‚Äì20: World Analyst üåç<br>‚Ä¢ Level 21+: Intelligence Master üß†`);
}

function showStreakInfo(){
  const msgs=['','Just getting started!','2 days in. Build the habit.','3 days ‚Äî you\'re forming a real habit!','4 days ‚Äî stronger than 80% of people.','5 days ‚Äî almost a full week!','6 days ‚Äî incredible consistency!','A FULL WEEK! You\'re a WORLD IQ warrior.'];
  const msg=msgs[Math.min(S.streak,msgs.length-1)]||`${S.streak} days and counting. Legendary.`;
  openLesson('üî•',`${S.streak} Day Streak!`,
    `<h3>Your Streak</h3>You've used WORLD IQ for <strong>${S.streak} consecutive day${S.streak>1?'s':''}.</strong><br><br>${msg}
    <h3>Why Streaks Matter</h3>Neuroscience shows it takes 21 days to form a habit and 66 days to make it automatic. Every day you open WORLD IQ, you're literally rewiring your brain to seek knowledge instead of dopamine from mindless scrolling.
    <div class="example-box">üèÜ <strong>Streak rewards:</strong> 7 days = "On Fire" badge ¬∑ 30 days = "Scholar" badge ¬∑ 100 days = "World IQ Master" badge. Keep going!</div>`);
}

function showAchieve(title,desc){
  openLesson('üèÜ',title,`<p>${desc}</p>`);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentInner=0;

function openArena(id){
  S.currentArena=id;
  S.arenaXP=0;
  const a=ARENAS[id];
  document.getElementById('homescreen').style.display='none';
  document.getElementById('arenascreen').style.display='block';
  document.getElementById('arena-top-name').textContent=a.name;
  document.getElementById('arena-top-sub').textContent=a.sub;
  document.getElementById('arena-xp-display').textContent='+0 XP today';
  switchInner(0);
  // visit bonus
  if(!S.visitedArenas.has(id)){
    S.visitedArenas.add(id);
    addXP(20);
    updateQuest();
  }
  window.scrollTo(0,0);
}

function goHome(){
  document.getElementById('arenascreen').style.display='none';
  document.getElementById('homescreen').style.display='block';
  window.scrollTo(0,0);
}

function switchInner(i){
  currentInner=i;
  document.querySelectorAll('.itab').forEach((t,j)=>t.classList.toggle('active',j===i));
  document.querySelectorAll('.ipanel').forEach((p,j)=>p.classList.toggle('active',j===i));
  const a=ARENAS[S.currentArena];

  if(i===0){
    // Live tab ‚Äî async renderer, passes container div directly
    const wrap = document.getElementById('live-content');
    wrap.innerHTML = `<div id="live-inner" style="background:var(--card);border:1px solid var(--border);border-radius:16px;padding:18px;margin-bottom:16px"></div>`;
    a.live(document.getElementById('live-inner'));
    recordCardCompletion(S.currentArena, 0);
  }
  if(i===1){
    document.getElementById('why-content').innerHTML=`<div style="background:var(--card);border:1px solid var(--border);border-radius:16px;padding:18px;margin-bottom:16px">${a.why()}</div>`;
    recordCardCompletion(S.currentArena, 1);
  }
  if(i===2){
    document.getElementById('forecast-content').innerHTML=a.forecast();
    setTimeout(animConf,300);
    recordCardCompletion(S.currentArena, 2);
  }
  if(i===3){buildGame();}
  if(i===4) buildLearn();
  if(i===5) buildTrainee();
}

function toggleWhy(el){
  el.classList.toggle('open');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LEARN TAB
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildLearn() {
  const lessons = ARENAS[S.currentArena].learn;
  const container = document.getElementById('learn-content');

  // Store bodies safely
  window._learnBodies = lessons.map(l => l.body);

  // Build HTML safely (no inline JS)
  container.innerHTML = `
    <div class="learn-grid">
      ${lessons.map((l, idx) => `
        <div class="learn-card" data-lesson-index="${idx}">
          <div class="lc-icon">${l.icon}</div>
          <div class="lc-title">${l.title}</div>
          <div class="lc-sub">${l.sub}</div>
          <div class="lc-badge">${l.badge}</div>
        </div>
      `).join('')}
    </div>

    <div style="
      background:rgba(124,58,237,0.06);
      border:1px solid rgba(124,58,237,0.15);
      border-radius:14px;
      padding:16px;
      text-align:center;
    ">
      <div style="font-size:24px;margin-bottom:8px">üß†</div>
      <div style="font-size:14px;font-weight:700;margin-bottom:4px">
        More lessons unlocking
      </div>
      <div style="font-size:12px;color:var(--muted)">
        Complete quizzes to unlock advanced lessons and earn XP
      </div>
    </div>
  `;

  // Attach click listeners safely
  document.querySelectorAll('.learn-card').forEach(card => {
    card.addEventListener('click', () => {
      const idx = card.dataset.lessonIndex;
      const lesson = lessons[idx];
      openLesson(lesson.icon, lesson.title, window._learnBodies[idx]);
    });
  });
}

function openLesson(icon,title,body){
  document.getElementById('lb-icon').textContent=icon;
  document.getElementById('lb-title').textContent=title;
  document.getElementById('lb-body').innerHTML=body;
  document.getElementById('lesson-modal').classList.add('show');
}
function closelesson(){document.getElementById('lesson-modal').classList.remove('show')}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CHART
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function generatePriceData(base,vol,days){
  const d=[];let v=base;
  for(let i=0;i<days;i++){v+=v*(Math.random()-0.48)*vol;d.push(Math.max(v*0.85,v));}
  return d;
}

function drawChart(){
  const canvas=document.getElementById('priceChart');
  if(!canvas) return;
  const ctx=canvas.getContext('2d');
  const W=canvas.offsetWidth; const H=180;
  canvas.width=W*devicePixelRatio; canvas.height=H*devicePixelRatio;
  ctx.scale(devicePixelRatio,devicePixelRatio);
  const goldData=generatePriceData(61000,0.012,30);
  const silverData=generatePriceData(7200,0.018,30).map(v=>v/10);
  function drawLine(data,color,gStart,gEnd){
    const min=Math.min(...data),max=Math.max(...data),range=max-min||1;
    const pts=data.map((v,i)=>({x:i/(data.length-1)*(W-20)+10,y:H-20-((v-min)/range)*(H-40)}));
    const grad=ctx.createLinearGradient(0,0,0,H);
    grad.addColorStop(0,gStart); grad.addColorStop(1,gEnd);
    ctx.beginPath(); pts.forEach((p,i)=>i?ctx.lineTo(p.x,p.y):ctx.moveTo(p.x,p.y));
    const pathCopy=new Path2D(); pts.forEach((p,i)=>i?pathCopy.lineTo(p.x,p.y):pathCopy.moveTo(p.x,p.y));
    ctx.strokeStyle=color; ctx.lineWidth=2; ctx.lineJoin='round'; ctx.stroke();
    ctx.lineTo(pts[pts.length-1].x,H-10); ctx.lineTo(pts[0].x,H-10); ctx.closePath();
    ctx.fillStyle=grad; ctx.fill();
  }
  ctx.clearRect(0,0,W,H);
  ctx.strokeStyle='rgba(255,255,255,0.04)'; ctx.lineWidth=1;
  for(let i=0;i<4;i++){const y=20+i*(H-40)/3;ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(W,y);ctx.stroke();}
  drawLine(goldData,'#f5c842','rgba(245,200,66,0.18)','rgba(245,200,66,0)');
  drawLine(silverData,'#c8d8ee','rgba(200,216,238,0.1)','rgba(200,216,238,0)');
}

function switchRange(btn,range){
  document.querySelectorAll('.rb').forEach(b=>b.classList.remove('act'));
  btn.classList.add('act');
  drawChart();
}

function animConf(){
  document.querySelectorAll('.ft-cfill[data-w]').forEach(el=>{
    el.style.width=el.getAttribute('data-w')+'%';
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// QUEST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateQuest(){
  const count=Math.min(S.visitedArenas.size,2);
  sessionStorage.setItem('wiq_quest',count);
  const el=document.getElementById('quest-count');
  if(el) el.textContent=count;
  const pct=count/2*100;
  const fill=document.getElementById('quest-fill');
  if(fill) fill.style.width=pct+'%';
  const pctEl=document.getElementById('quest-pct');
  if(pctEl) pctEl.textContent=pct+'%';
  if(count>=2 && !sessionStorage.getItem('wiq_quest_done')){
    sessionStorage.setItem('wiq_quest_done','1');
    addXP(150);
    showLevelUp('Daily Quest Complete! +150 XP');
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CLOCK
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateClock(){
  const now=new Date();
  document.getElementById('topbar-clock').textContent=
    now.toLocaleTimeString('en-IN',{hour:'2-digit',minute:'2-digit'});
  const h=now.getHours();
  const el=document.getElementById('home-greeting');
  if(el) el.textContent=h<12?'‚òÄÔ∏è Good Morning':h<17?'üå§ Good Afternoon':'üåô Good Evening';
}
setInterval(updateClock,1000); updateClock();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
updateXPBar();
updateQuest();
window.addEventListener('resize',()=>{if(document.getElementById('priceChart'))drawChart();});

async function signup() {
  const username = document.getElementById("username").value;
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  if (!email || !password || !username) {
    alert("Please fill all fields");
    return;
  }

  if (!window.supabaseClient) {
    alert("Supabase not initialized. Please refresh the page.");
    console.error("window.supabaseClient is undefined");
    return;
  }

  try {
    const { data, error } = await window.supabaseClient.auth.signUp({
      email,
      password,
    });

    if (error) {
      console.error("Signup error:", error);
      alert(`Error: ${error.message}`);
      return;
    }

    alert("Account created! Please login.");
  } catch (err) {
    console.error("Signup exception:", err);
    alert("Signup failed. Check console for details.");
  }
}

async function login() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  if (!email || !password) {
    alert("Please fill all fields");
    return;
  }

  if (!window.supabaseClient) {
    alert("Supabase not initialized. Please refresh the page.");
    console.error("window.supabaseClient is undefined");
    return;
  }

  try {
    const { error } = await window.supabaseClient.auth.signInWithPassword({
      email,
      password
    });

    if (error) {
      console.error("Login error:", error);
      alert(`Error: ${error.message}`);
      return;
    }

    showApp();
  } catch (err) {
    console.error("Login exception:", err);
    alert("Login failed. Check console for details.");
  }
}
async function logout() {
  if (window.supabaseClient) {
    await window.supabaseClient.auth.signOut();
  }

  localStorage.clear();
  sessionStorage.clear();

  // Reset UI values
  document.getElementById("xp-val").innerText = "0";
  document.getElementById("lv-num").innerText = "1";
  document.getElementById("str-num").innerText = "1";
  document.getElementById("tb-username").innerText = "Guest";

  showAuth();
}
function initApp() {
  showApp();
  updateXPBar();
  updateQuest();
  updateClock();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SESSION CHECK ON PAGE LOAD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.addEventListener("DOMContentLoaded", async () => {
  try {
    if (!window.supabaseClient) {
      console.warn("Supabase client not initialized");
      showAuth();
      return;
    }

    const { data } = await window.supabaseClient.auth.getSession();
    if (data.session) {
      initApp();
    } else {
      showAuth();
    }
  } catch (err) {
    console.error("Session check error:", err);
    showAuth();
  }
});

</script>
</body>
</html>